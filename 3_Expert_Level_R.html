<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="From beginner to expert: R fundamentals, data analysis, modeling, and development tools.">

<title>5&nbsp; Expert Level R – R Programming Course</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./4_Shiny_Apps_in_R.html" rel="next">
<link href="./2_Intermediate_Level_R.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d4ddd70199c5344cde2833b50fd7d7ac.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./logo.webp" alt="" class="navbar-logo light-content">
    <img src="./logo.webp" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">R Programming Course</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./3_Expert_Level_R.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Expert Level R</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">R Programming Course</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Authors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1_Beginner_Level_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Beginner Level R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2_Intermediate_Level_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intermediate Level R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3_Expert_Level_R.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Expert Level R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4_Shiny_Apps_in_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shiny Apps in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5_Modules_and_Functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modules and Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6_R_Developer_Tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">R Developer Tools</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Time Series Analysis and Forecasting of Air Passengers</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Code &amp; Data Resources</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link active" data-scroll-target="#table-of-contents"><span class="header-section-number">5.1</span> Table of Contents</a></li>
  <li><a href="#statistical-modeling" id="toc-statistical-modeling" class="nav-link" data-scroll-target="#statistical-modeling"><span class="header-section-number">5.2</span> Statistical Modeling</a>
  <ul class="collapse">
  <li><a href="#linear-regression" id="toc-linear-regression" class="nav-link" data-scroll-target="#linear-regression"><span class="header-section-number">5.2.1</span> Linear Regression</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">5.2.2</span> Logistic Regression</a></li>
  <li><a href="#generalized-linear-models-glm" id="toc-generalized-linear-models-glm" class="nav-link" data-scroll-target="#generalized-linear-models-glm"><span class="header-section-number">5.2.3</span> Generalized Linear Models (GLM)</a></li>
  <li><a href="#mixed-effects-models" id="toc-mixed-effects-models" class="nav-link" data-scroll-target="#mixed-effects-models"><span class="header-section-number">5.2.4</span> Mixed Effects Models</a></li>
  <li><a href="#survival-analysis" id="toc-survival-analysis" class="nav-link" data-scroll-target="#survival-analysis"><span class="header-section-number">5.2.5</span> Survival Analysis</a></li>
  </ul></li>
  <li><a href="#machine-learning-with-caret" id="toc-machine-learning-with-caret" class="nav-link" data-scroll-target="#machine-learning-with-caret"><span class="header-section-number">5.3</span> Machine Learning with caret</a>
  <ul class="collapse">
  <li><a href="#setup-and-data-splitting" id="toc-setup-and-data-splitting" class="nav-link" data-scroll-target="#setup-and-data-splitting"><span class="header-section-number">5.3.1</span> Setup and Data Splitting</a></li>
  <li><a href="#training-models" id="toc-training-models" class="nav-link" data-scroll-target="#training-models"><span class="header-section-number">5.3.2</span> Training Models</a></li>
  <li><a href="#predictions-and-evaluation" id="toc-predictions-and-evaluation" class="nav-link" data-scroll-target="#predictions-and-evaluation"><span class="header-section-number">5.3.3</span> Predictions and Evaluation</a></li>
  <li><a href="#model-comparison" id="toc-model-comparison" class="nav-link" data-scroll-target="#model-comparison"><span class="header-section-number">5.3.4</span> Model Comparison</a></li>
  </ul></li>
  <li><a href="#advanced-ml-algorithms" id="toc-advanced-ml-algorithms" class="nav-link" data-scroll-target="#advanced-ml-algorithms"><span class="header-section-number">5.4</span> Advanced ML Algorithms</a>
  <ul class="collapse">
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost"><span class="header-section-number">5.4.1</span> XGBoost</a></li>
  <li><a href="#random-forest-ranger" id="toc-random-forest-ranger" class="nav-link" data-scroll-target="#random-forest-ranger"><span class="header-section-number">5.4.2</span> Random Forest (ranger)</a></li>
  <li><a href="#deep-learning-with-keras" id="toc-deep-learning-with-keras" class="nav-link" data-scroll-target="#deep-learning-with-keras"><span class="header-section-number">5.4.3</span> Deep Learning with keras</a></li>
  </ul></li>
  <li><a href="#model-evaluation-and-tuning" id="toc-model-evaluation-and-tuning" class="nav-link" data-scroll-target="#model-evaluation-and-tuning"><span class="header-section-number">5.5</span> Model Evaluation and Tuning</a>
  <ul class="collapse">
  <li><a href="#hyperparameter-tuning" id="toc-hyperparameter-tuning" class="nav-link" data-scroll-target="#hyperparameter-tuning"><span class="header-section-number">5.5.1</span> Hyperparameter Tuning</a></li>
  <li><a href="#cross-validation-strategies" id="toc-cross-validation-strategies" class="nav-link" data-scroll-target="#cross-validation-strategies"><span class="header-section-number">5.5.2</span> Cross-Validation Strategies</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection"><span class="header-section-number">5.5.3</span> Feature Selection</a></li>
  <li><a href="#ensemble-methods" id="toc-ensemble-methods" class="nav-link" data-scroll-target="#ensemble-methods"><span class="header-section-number">5.5.4</span> Ensemble Methods</a></li>
  </ul></li>
  <li><a href="#time-series-analysis" id="toc-time-series-analysis" class="nav-link" data-scroll-target="#time-series-analysis"><span class="header-section-number">5.6</span> Time Series Analysis</a>
  <ul class="collapse">
  <li><a href="#basic-time-series" id="toc-basic-time-series" class="nav-link" data-scroll-target="#basic-time-series"><span class="header-section-number">5.6.1</span> Basic Time Series</a></li>
  <li><a href="#arima-models" id="toc-arima-models" class="nav-link" data-scroll-target="#arima-models"><span class="header-section-number">5.6.2</span> ARIMA Models</a></li>
  <li><a href="#exponential-smoothing" id="toc-exponential-smoothing" class="nav-link" data-scroll-target="#exponential-smoothing"><span class="header-section-number">5.6.3</span> Exponential Smoothing</a></li>
  <li><a href="#prophet-facebook" id="toc-prophet-facebook" class="nav-link" data-scroll-target="#prophet-facebook"><span class="header-section-number">5.6.4</span> Prophet (Facebook)</a></li>
  </ul></li>
  <li><a href="#r-markdown-and-reproducible-research" id="toc-r-markdown-and-reproducible-research" class="nav-link" data-scroll-target="#r-markdown-and-reproducible-research"><span class="header-section-number">5.7</span> R Markdown and Reproducible Research</a>
  <ul class="collapse">
  <li><a href="#basic-r-markdown" id="toc-basic-r-markdown" class="nav-link" data-scroll-target="#basic-r-markdown"><span class="header-section-number">5.7.1</span> Basic R Markdown</a></li>
  </ul></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis"><span class="header-section-number">5.8</span> Data Analysis</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization"><span class="header-section-number">5.9</span> Visualization</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">5.10</span> Conclusion</a></li>
  <li><a href="#child-documents" id="toc-child-documents" class="nav-link" data-scroll-target="#child-documents"><span class="header-section-number">6</span> Child documents</a></li>
  <li><a href="#tables-with-kable" id="toc-tables-with-kable" class="nav-link" data-scroll-target="#tables-with-kable"><span class="header-section-number">7</span> Tables with kable</a></li>
  <li><a href="#interactive-tables" id="toc-interactive-tables" class="nav-link" data-scroll-target="#interactive-tables"><span class="header-section-number">8</span> Interactive tables</a>
  <ul class="collapse">
  <li><a href="#performance-optimization" id="toc-performance-optimization" class="nav-link" data-scroll-target="#performance-optimization"><span class="header-section-number">8.1</span> Performance Optimization</a>
  <ul class="collapse">
  <li><a href="#profiling-code" id="toc-profiling-code" class="nav-link" data-scroll-target="#profiling-code"><span class="header-section-number">8.1.1</span> Profiling Code</a></li>
  <li><a href="#vectorization" id="toc-vectorization" class="nav-link" data-scroll-target="#vectorization"><span class="header-section-number">8.1.2</span> Vectorization</a></li>
  <li><a href="#parallel-processing" id="toc-parallel-processing" class="nav-link" data-scroll-target="#parallel-processing"><span class="header-section-number">8.1.3</span> Parallel Processing</a></li>
  <li><a href="#data.table-for-speed" id="toc-data.table-for-speed" class="nav-link" data-scroll-target="#data.table-for-speed"><span class="header-section-number">8.1.4</span> data.table for Speed</a></li>
  </ul></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics"><span class="header-section-number">8.2</span> Advanced Topics</a>
  <ul class="collapse">
  <li><a href="#custom-functions-and-debugging" id="toc-custom-functions-and-debugging" class="nav-link" data-scroll-target="#custom-functions-and-debugging"><span class="header-section-number">8.2.1</span> Custom Functions and Debugging</a></li>
  <li><a href="#s3-and-s4-classes" id="toc-s3-and-s4-classes" class="nav-link" data-scroll-target="#s3-and-s4-classes"><span class="header-section-number">8.2.2</span> S3 and S4 Classes</a></li>
  <li><a href="#writing-packages" id="toc-writing-packages" class="nav-link" data-scroll-target="#writing-packages"><span class="header-section-number">8.2.3</span> Writing Packages</a></li>
  </ul></li>
  <li><a href="#practice-projects" id="toc-practice-projects" class="nav-link" data-scroll-target="#practice-projects"><span class="header-section-number">8.3</span> Practice Projects</a>
  <ul class="collapse">
  <li><a href="#project-1-predictive-modeling-pipeline" id="toc-project-1-predictive-modeling-pipeline" class="nav-link" data-scroll-target="#project-1-predictive-modeling-pipeline"><span class="header-section-number">8.3.1</span> Project 1: Predictive Modeling Pipeline</a></li>
  <li><a href="#project-2-time-series-forecasting" id="toc-project-2-time-series-forecasting" class="nav-link" data-scroll-target="#project-2-time-series-forecasting"><span class="header-section-number">8.3.2</span> Project 2: Time Series Forecasting</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">8.4</span> Summary</a>
  <ul class="collapse">
  <li><a href="#skills-mastered" id="toc-skills-mastered" class="nav-link" data-scroll-target="#skills-mastered"><span class="header-section-number">8.4.1</span> Skills Mastered</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps"><span class="header-section-number">8.4.2</span> Next Steps</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Expert Level R</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="table-of-contents" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="table-of-contents"><span class="header-section-number">5.1</span> Table of Contents</h2>
<ol type="1">
<li><a href="#statistical-modeling">Statistical Modeling</a></li>
<li><a href="#machine-learning-with-caret">Machine Learning with caret</a></li>
<li><a href="#advanced-ml-algorithms">Advanced ML Algorithms</a></li>
<li><a href="#model-evaluation-and-tuning">Model Evaluation and Tuning</a></li>
<li><a href="#time-series-analysis">Time Series Analysis</a></li>
<li><a href="#r-markdown">R Markdown and Reproducible Research</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#advanced-topics">Advanced Topics</a></li>
</ol>
<hr>
</section>
<section id="statistical-modeling" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="statistical-modeling"><span class="header-section-number">5.2</span> Statistical Modeling</h2>
<section id="linear-regression" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="linear-regression"><span class="header-section-number">5.2.1</span> Linear Regression</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple linear regression</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple regression</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> hp <span class="sc">+</span> cyl, <span class="at">data =</span> mtcars)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">wt =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">3.0</span>, <span class="fl">3.5</span>), <span class="at">hp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">140</span>), <span class="at">cyl =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, new_data, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Model diagnostics</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Check assumptions</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model)  <span class="co"># Variance Inflation Factor (multicollinearity)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(model)  <span class="co"># Autocorrelation</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(model)  <span class="co"># Heteroscedasticity</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual analysis</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(residuals)  <span class="co"># Normality test</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation" class="level4" data-number="5.2.1.1">
<h4 data-number="5.2.1.1" class="anchored" data-anchor-id="math-and-explanation"><span class="header-section-number">5.2.1.1</span> Math and Explanation</h4>
<p>We observe a response <span class="math inline">\(y_i\)</span> and <span class="math inline">\(p\)</span> predictors <span class="math inline">\(x_{i1},\dots,x_{ip}\)</span> for <span class="math inline">\(i = 1,\dots,n\)</span>. Linear regression assumes the conditional mean of <span class="math inline">\(Y\)</span> is a linear function of the predictors:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_{i1} + \cdots + \beta_p x_{ip} + \varepsilon_i,
\]</span></p>
<p>or in matrix form</p>
<p><span class="math display">\[
\mathbf{y} = X\beta + \varepsilon,
\]</span></p>
<p>where <span class="math inline">\(X\)</span> is the <span class="math inline">\(n \times (p+1)\)</span> design matrix (including a column of ones for the intercept), <span class="math inline">\(\beta\)</span> is the vector of coefficients, and <span class="math inline">\(\varepsilon\)</span> is an error term (often modeled as <span class="math inline">\(\varepsilon \sim \mathcal{N}(0, \sigma^2 I)\)</span>).</p>
<p>The <strong>ordinary least squares (OLS)</strong> estimator chooses <span class="math inline">\(\hat\beta\)</span> to minimize the sum of squared residuals:</p>
<p><span class="math display">\[
\hat\beta = \arg\min_\beta \sum_{i=1}^n (y_i - \hat y_i)^2
            = \arg\min_\beta \lVert \mathbf{y} - X\beta \rVert_2^2.
\]</span></p>
<p>When <span class="math inline">\(X^\top X\)</span> is invertible, the minimizer has the closed form</p>
<p><span class="math display">\[
\hat\beta = (X^\top X)^{-1} X^\top \mathbf{y}.
\]</span></p>
<p>The diagnostic code (residual plots, variance inflation factor, Durbin–Watson test, tests for heteroscedasticity and normality) is checking whether the usual assumptions—linearity, independence, constant variance, and approximately normal residuals—are reasonable for this model.</p>
</section>
</section>
<section id="logistic-regression" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">5.2.2</span> Logistic Regression</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary classification</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>iris_binary <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>Species <span class="sc">!=</span> <span class="st">"setosa"</span>, ]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>iris_binary<span class="sc">$</span>Species <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(iris_binary<span class="sc">$</span>Species)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Species <span class="sc">~</span> Sepal.Length <span class="sc">+</span> Sepal.Width, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> iris_binary, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>predicted_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"virginica"</span>, <span class="st">"versicolor"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Predicted =</span> predicted_class, <span class="at">Actual =</span> iris_binary<span class="sc">$</span>Species)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curve and AUC</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(iris_binary<span class="sc">$</span>Species, predictions)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_obj, <span class="at">main =</span> <span class="st">"ROC Curve"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(roc_obj)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(model))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-1" class="level4" data-number="5.2.2.1">
<h4 data-number="5.2.2.1" class="anchored" data-anchor-id="math-and-explanation-1"><span class="header-section-number">5.2.2.1</span> Math and Explanation</h4>
<p>For a binary response <span class="math inline">\(Y \in \{0,1\}\)</span> and predictors <span class="math inline">\(x\)</span>, logistic regression models the conditional probability of the positive class as</p>
<p><span class="math display">\[
P(Y = 1 \mid x) = p(x) = \sigma(\eta) = \frac{1}{1 + e^{-\eta}}, \quad \eta = \beta_0 + \beta^\top x.
\]</span></p>
<p>Equivalently, the <strong>log-odds</strong> (logit) are linear in the predictors:</p>
<p><span class="math display">\[
\log\frac{p(x)}{1 - p(x)} = \beta_0 + \beta^\top x.
\]</span></p>
<p>Given data <span class="math inline">\((x_i, y_i)\)</span>, <span class="math inline">\(i = 1,\dots,n\)</span>, the likelihood of the parameters <span class="math inline">\(\beta\)</span> is</p>
<p><span class="math display">\[
L(\beta) = \prod_{i=1}^n p(x_i)^{y_i} [1 - p(x_i)]^{1-y_i},
\]</span></p>
<p>with log-likelihood</p>
<p><span class="math display">\[
\ell(\beta) = \sum_{i=1}^n \big[ y_i \log p(x_i) + (1-y_i) \log(1-p(x_i)) \big].
\]</span></p>
<p>The fitted coefficients <span class="math inline">\(\hat\beta\)</span> <strong>maximize</strong> <span class="math inline">\(\ell(\beta)\)</span> (or minimize the negative log-likelihood, a cross-entropy loss). There is no closed-form solution, so numerical methods such as iteratively reweighted least squares or gradient-based optimization are used.</p>
<p>Each coefficient <span class="math inline">\(\beta_j\)</span> represents the change in <strong>log-odds</strong> of <span class="math inline">\(Y=1\)</span> for a one-unit increase in <span class="math inline">\(x_j\)</span>, holding other predictors fixed. Exponentiating gives an <strong>odds ratio</strong> <span class="math inline">\(e^{\beta_j}\)</span>, which is what <code>exp(coef(model))</code> and <code>exp(confint(model))</code> report. The ROC curve and AUC summarize how well the predicted probabilities separate the two classes over all possible thresholds.</p>
</section>
</section>
<section id="generalized-linear-models-glm" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="generalized-linear-models-glm"><span class="header-section-number">5.2.3</span> Generalized Linear Models (GLM)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson regression (count data)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> factor1 <span class="sc">+</span> factor2, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> df)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative binomial (overdispersed count data)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>model_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(count <span class="sc">~</span> factor1 <span class="sc">+</span> factor2, <span class="at">data =</span> df)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Gamma regression (continuous positive data)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>model_gamma <span class="ot">&lt;-</span> <span class="fu">glm</span>(response <span class="sc">~</span> predictor, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-2" class="level4" data-number="5.2.3.1">
<h4 data-number="5.2.3.1" class="anchored" data-anchor-id="math-and-explanation-2"><span class="header-section-number">5.2.3.1</span> Math and Explanation</h4>
<p>Generalized linear models extend linear regression to non-Gaussian response distributions from the <strong>exponential family</strong>. For observation <span class="math inline">\(i\)</span> we write</p>
<p><span class="math display">\[
g(\mu_i) = \eta_i = x_i^\top \beta, \quad \mu_i = \mathbb{E}[Y_i \mid x_i],
\]</span></p>
<p>where <span class="math inline">\(g(\cdot)\)</span> is a link function and <span class="math inline">\(\mu_i\)</span> is the conditional mean of <span class="math inline">\(Y_i\)</span>.</p>
<p>In this code:</p>
<ul>
<li><strong>Poisson regression</strong> assumes <span class="math inline">\(Y_i \sim \text{Poisson}(\lambda_i)\)</span> for count data and uses the log link <span class="math display">\[\log(\lambda_i) = x_i^\top \beta.\]</span></li>
<li><strong>Negative binomial regression</strong> also models counts but introduces an additional dispersion parameter to handle overdispersion (variance greater than the mean), again with a log link.</li>
<li><strong>Gamma regression</strong> assumes <span class="math inline">\(Y_i\)</span> is positive and continuous and often uses a log link <span class="math display">\[\log(\mu_i) = x_i^\top \beta.\]</span></li>
</ul>
<p>The parameters <span class="math inline">\(\beta\)</span> are estimated by <strong>maximum likelihood</strong>, i.e.</p>
<p><span class="math display">\[
\hat\beta = \arg\max_\beta \; \ell(\beta),
\]</span></p>
<p>where <span class="math inline">\(\ell(\beta)\)</span> is the log-likelihood implied by the chosen distribution and link. In practice, <code>glm()</code> uses <strong>iteratively reweighted least squares (IRLS)</strong> to solve this optimization by repeatedly fitting weighted least-squares regressions until convergence.</p>
<p>Diagnostics for GLMs focus on whether the chosen distribution and link adequately capture the mean–variance relationship (e.g.&nbsp;checking residuals, deviance, and overdispersion for Poisson models).</p>
</section>
</section>
<section id="mixed-effects-models" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="mixed-effects-models"><span class="header-section-number">5.2.4</span> Mixed Effects Models</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear mixed model</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(reaction <span class="sc">~</span> days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> days <span class="sc">|</span> subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Random intercept and slope</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (x <span class="sc">|</span> group), <span class="at">data =</span> df)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract random effects</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(model)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(model)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Model comparison</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> group), <span class="at">data =</span> df)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> x <span class="sc">|</span> group), <span class="at">data =</span> df)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-3" class="level4" data-number="5.2.4.1">
<h4 data-number="5.2.4.1" class="anchored" data-anchor-id="math-and-explanation-3"><span class="header-section-number">5.2.4.1</span> Math and Explanation</h4>
<p>Mixed effects (multilevel) models include both <strong>fixed effects</strong>, which are shared across all groups, and <strong>random effects</strong>, which capture group-specific deviations.</p>
<p>A simple linear mixed model for observation <span class="math inline">\(i\)</span> in group <span class="math inline">\(j\)</span> can be written as</p>
<p><span class="math display">\[
y_{ij} = \beta_0 + \beta^\top x_{ij} + b_{0j} + b_j^\top z_{ij} + \varepsilon_{ij},
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(\beta\)</span> are fixed-effect coefficients,</li>
<li><span class="math inline">\(b_j\)</span> are random effects for group <span class="math inline">\(j\)</span> (typically <span class="math inline">\(b_j \sim \mathcal{N}(0, \Sigma_b)\)</span>),</li>
<li><span class="math inline">\(z_{ij}\)</span> selects which random effects apply to observation <span class="math inline">\(ij\)</span>,</li>
<li><span class="math inline">\(\varepsilon_{ij} \sim \mathcal{N}(0, \sigma^2)\)</span> are residual errors.</li>
</ul>
<p>Formulas like <code>reaction ~ days + (1 + days | subject)</code> tell <code>lmer()</code> to include a fixed effect of <code>days</code> plus random intercepts and random slopes by <code>subject</code>.</p>
<p>Estimation proceeds by maximizing the <strong>(restricted) marginal likelihood</strong> obtained by integrating out the random effects:</p>
<p><span class="math display">\[
L(\beta, \Sigma_b, \sigma^2) = \prod_j \int f(y_j \mid b_j, \beta, \sigma^2) f(b_j \mid \Sigma_b)\, db_j.
\]</span></p>
<p><code>lme4</code> uses numerical methods (Laplace approximation, sparse linear algebra) to approximate this likelihood efficiently. The <code>anova(model1, model2)</code> call is performing a likelihood-ratio test between nested mixed-effect models to assess whether the more complex random-effect structure significantly improves model fit.</p>
</section>
</section>
<section id="survival-analysis" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="survival-analysis"><span class="header-section-number">5.2.5</span> Survival Analysis</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier survival curve</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> group, <span class="at">data =</span> lung)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Survival Probability"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Group 1"</span>, <span class="st">"Group 2"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-rank test</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> group, <span class="at">data =</span> lung)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox proportional hazards model</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>cox_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> ph.ecog, <span class="at">data =</span> lung)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox_model)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Hazard ratios</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(cox_model))</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(cox_model))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-4" class="level4" data-number="5.2.5.1">
<h4 data-number="5.2.5.1" class="anchored" data-anchor-id="math-and-explanation-4"><span class="header-section-number">5.2.5.1</span> Math and Explanation</h4>
<p>Let <span class="math inline">\(T\)</span> be a time-to-event random variable. Two key functions in survival analysis are:</p>
<ul>
<li><strong>Survival function</strong>: <span class="math inline">\(S(t) = P(T &gt; t)\)</span>.</li>
<li><strong>Hazard function</strong>: <span class="math inline">\(h(t) = \lim_{\Delta t \to 0} P(t \le T &lt; t + \Delta t \mid T \ge t)/\Delta t\)</span>.</li>
</ul>
<p>The Kaplan–Meier estimator used by <code>survfit()</code> estimates <span class="math inline">\(S(t)\)</span> nonparametrically by multiplying conditional survival probabilities at each observed event time.</p>
<p>The <strong>Cox proportional hazards model</strong> assumes that the hazard for subject <span class="math inline">\(i\)</span> with covariates <span class="math inline">\(x_i\)</span> is</p>
<p><span class="math display">\[
h(t \mid x_i) = h_0(t) \exp(\beta^\top x_i),
\]</span></p>
<p>where <span class="math inline">\(h_0(t)\)</span> is an unspecified baseline hazard and <span class="math inline">\(\beta\)</span> are regression coefficients.</p>
<p>Instead of a full likelihood, Cox regression maximizes the <strong>partial likelihood</strong></p>
<p><span class="math display">\[
L_p(\beta) = \prod_{i \in \mathcal{D}} \frac{\exp(\beta^\top x_i)}{\sum_{j \in R_i} \exp(\beta^\top x_j)},
\]</span></p>
<p>where <span class="math inline">\(\mathcal{D}\)</span> is the set of event times and <span class="math inline">\(R_i\)</span> is the risk set at the time of event <span class="math inline">\(i\)</span>. Maximizing <span class="math inline">\(L_p(\beta)\)</span> yields estimates <span class="math inline">\(\hat\beta\)</span>, and</p>
<p><span class="math display">\[
\exp(\beta_j)
\]</span></p>
<p>is interpreted as a <strong>hazard ratio</strong>: the multiplicative change in hazard for a one-unit increase in covariate <span class="math inline">\(x_j\)</span>.</p>
<p>The log-rank test compares two (or more) survival curves under the null hypothesis that their hazard functions are equal over time.</p>
<hr>
</section>
</section>
</section>
<section id="machine-learning-with-caret" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="machine-learning-with-caret"><span class="header-section-number">5.3</span> Machine Learning with caret</h2>
<section id="setup-and-data-splitting" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="setup-and-data-splitting"><span class="header-section-number">5.3.1</span> Setup and Data Splitting</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris<span class="sc">$</span>Species, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> iris[trainIndex, ]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> iris[<span class="sc">-</span>trainIndex, ]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validation setup</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> multiClassSummary</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="training-models" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="training-models"><span class="header-section-number">5.3.2</span> Training Models</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">5</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Support Vector Machine</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>svm_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"svmRadial"</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">5</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient Boosting</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>gbm_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"gbm"</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Neural Network</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>nnet_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nnet"</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-5" class="level4" data-number="5.3.2.1">
<h4 data-number="5.3.2.1" class="anchored" data-anchor-id="math-and-explanation-5"><span class="header-section-number">5.3.2.1</span> Math and Explanation</h4>
<p>Although <code>caret::train()</code> hides the underlying optimization details, each <code>method</code> corresponds to a specific model class and loss function:</p>
<ul>
<li><strong>Random Forest (<code>method = "rf"</code>)</strong>
<ul>
<li>An ensemble of decision trees <span class="math inline">\(\{T_b(x)\}_{b=1}^B\)</span> grown on bootstrap samples.</li>
<li>For classification, the prediction is the <strong>majority vote</strong> of the trees.</li>
<li>Each split in a tree greedily chooses the feature and split point that maximizes decrease in node impurity (e.g.&nbsp;Gini index <span class="math display">\[
G = \sum_k p_k(1-p_k),
\]</span> where <span class="math inline">\(p_k\)</span> is the class proportion in that node).</li>
</ul></li>
<li><strong>Support Vector Machine (<code>method = "svmRadial"</code>)</strong>
<ul>
<li>Finds a separating surface with maximum margin. In the soft-margin formulation it solves <span class="math display">\[
\min_{w,b,\xi} \; \tfrac{1}{2}\lVert w \rVert^2 + C \sum_{i=1}^n \xi_i
\]</span> subject to <span class="math display">\[
y_i (w^T \phi(x_i) + b) \ge 1 - \xi_i, \quad \xi_i \ge 0,
\]</span> where <span class="math inline">\(\phi(\cdot)\)</span> is induced by the RBF kernel and <span class="math inline">\(C\)</span> controls the penalty for misclassification.</li>
</ul></li>
<li><strong>Gradient Boosting (<code>method = "gbm"</code>)</strong>
<ul>
<li>Builds an additive model of weak learners <span class="math display">\[
F_M(x) = \sum_{m=1}^M \gamma_m h_m(x),
\]</span> where each new tree <span class="math inline">\(h_m\)</span> is fit to approximate the <strong>negative gradient</strong> of the loss with respect to the current predictions.</li>
<li>This is a stagewise functional gradient descent procedure that iteratively reduces training loss.</li>
</ul></li>
<li><strong>Neural Network (<code>method = "nnet"</code>)</strong>
<ul>
<li>Typically a single hidden layer with non-linear activation: <span class="math display">\[
h = \sigma(W^{(1)} x + b^{(1)}), \quad \hat y = f(W^{(2)} h + b^{(2)}),
\]</span> where <span class="math inline">\(\sigma\)</span> is an activation (e.g.&nbsp;logistic, ReLU) and <span class="math inline">\(f\)</span> is softmax (classification) or identity (regression).</li>
<li>Training minimizes a loss such as cross-entropy using gradient descent and backpropagation.</li>
</ul></li>
</ul>
<p><code>caret</code> handles resampling (cross-validation), hyperparameter tuning, and calling the appropriate underlying algorithms, but the optimization for each model follows these mathematical objectives.</p>
</section>
</section>
<section id="predictions-and-evaluation" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="predictions-and-evaluation"><span class="header-section-number">5.3.3</span> Predictions and Evaluation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model, test_data)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion Matrix</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf_pred, test_data<span class="sc">$</span>Species)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple metrics</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(rf_pred, test_data<span class="sc">$</span>Species)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(rf_model)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(rf_model), <span class="at">top =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="model-comparison" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="model-comparison"><span class="header-section-number">5.3.4</span> Model Comparison</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare multiple models</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">resamples</span>(<span class="fu">list</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">RF =</span> rf_model,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVM =</span> svm_model,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">GBM =</span> gbm_model,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">NNET =</span> nnet_model</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(results)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot</span>(results)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(results)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical test</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>diff_results <span class="ot">&lt;-</span> <span class="fu">diff</span>(results)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diff_results)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="advanced-ml-algorithms" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="advanced-ml-algorithms"><span class="header-section-number">5.4</span> Advanced ML Algorithms</h2>
<section id="xgboost" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="xgboost"><span class="header-section-number">5.4.1</span> XGBoost</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>train_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>train_label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>Species) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>test_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DMatrix</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_matrix, <span class="at">label =</span> train_label)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_matrix)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"multi:softmax"</span>,</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_class =</span> <span class="dv">3</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.3</span>,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">watchlist =</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, dtest)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> xgb_model)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importance, <span class="at">top_n =</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-6" class="level4" data-number="5.4.1.1">
<h4 data-number="5.4.1.1" class="anchored" data-anchor-id="math-and-explanation-6"><span class="header-section-number">5.4.1.1</span> Math and Explanation</h4>
<p>XGBoost fits an additive ensemble of decision trees:</p>
<p><span class="math display">\[
\hat y_i = \sum_{k=1}^K f_k(x_i), \quad f_k \in \mathcal{F},
\]</span></p>
<p>where each <span class="math inline">\(f_k\)</span> is a regression tree that assigns a constant score to each leaf region.</p>
<p>For a loss function <span class="math inline">\(l(y_i, \hat y_i)\)</span>, it minimizes the <strong>regularized objective</strong></p>
<p><span class="math display">\[
\mathcal{L} = \sum_{i=1}^n l\big(y_i, \hat y_i\big)
            + \sum_{k=1}^K \Omega(f_k),
\]</span></p>
<p>with tree complexity penalty</p>
<p><span class="math display">\[
\Omega(f) = \gamma T + \tfrac{1}{2} \lambda \lVert w \rVert^2,
\]</span></p>
<p>where <span class="math inline">\(T\)</span> is the number of leaves and <span class="math inline">\(w\)</span> are the leaf scores. At each boosting iteration, XGBoost uses a second-order Taylor expansion of the loss around the current predictions to compute optimal leaf weights and select splits, giving a fast approximation to gradient-boosted trees with built-in regularization.</p>
<p>Hyperparameters such as <code>max_depth</code>, <code>eta</code> (learning rate), <code>subsample</code>, and <code>colsample_bytree</code> control how complex each tree can be and how strongly the ensemble is regularized.</p>
</section>
</section>
<section id="random-forest-ranger" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="random-forest-ranger"><span class="header-section-number">5.4.2</span> Random Forest (ranger)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast random forest</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>rf_fast <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">500</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"impurity"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">probability =</span> <span class="cn">TRUE</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_fast, test_data)<span class="sc">$</span>predictions</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(rf_fast)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-7" class="level4" data-number="5.4.2.1">
<h4 data-number="5.4.2.1" class="anchored" data-anchor-id="math-and-explanation-7"><span class="header-section-number">5.4.2.1</span> Math and Explanation</h4>
<p>The <code>ranger</code> model is a fast implementation of the same random forest idea used earlier: many decision trees are grown on bootstrap samples of the data, and predictions are aggregated.</p>
<p>If <span class="math inline">\(T_b(x)\)</span> denotes the prediction of tree <span class="math inline">\(b\)</span>, then for classification the forest prediction is typically</p>
<p><span class="math display">\[
\hat y = \text{mode}\{T_1(x), T_2(x), \dots, T_B(x)\},
\]</span></p>
<p>and for regression it is the average. Each tree is built by recursively selecting splits that maximize the reduction in node impurity (e.g.&nbsp;Gini index for classification) while only considering a random subset of predictors at each node.</p>
<p>This combination of <strong>bagging</strong> (bootstrap aggregation) and <strong>random feature selection</strong> reduces variance and decorrelates individual trees, leading to strong predictive performance without overfitting as badly as a single deep tree. The importance scores from <code>importance(rf_fast)</code> summarize how much each variable contributes to reducing impurity across the forest.</p>
</section>
</section>
<section id="deep-learning-with-keras" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="deep-learning-with-keras"><span class="header-section-number">5.4.3</span> Deep Learning with keras</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">to_categorical</span>(<span class="fu">as.numeric</span>(train_data<span class="sc">$</span>Species) <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Build model</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">64</span>, <span class="at">activation =</span> <span class="st">"relu"</span>, <span class="at">input_shape =</span> <span class="fu">ncol</span>(x_train)) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">32</span>, <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">3</span>, <span class="at">activation =</span> <span class="st">"softmax"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">compile</span>(</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">loss =</span> <span class="st">"categorical_crossentropy"</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">lr =</span> <span class="fl">0.001</span>),</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"accuracy"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Train</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  x_train, y_train,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">100</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">16</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training history</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(history)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(x_test)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>predicted_class <span class="ot">&lt;-</span> <span class="fu">max.col</span>(predictions) <span class="sc">-</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-8" class="level4" data-number="5.4.3.1">
<h4 data-number="5.4.3.1" class="anchored" data-anchor-id="math-and-explanation-8"><span class="header-section-number">5.4.3.1</span> Math and Explanation</h4>
<p>The <code>keras</code> example builds a fully connected <strong>neural network</strong> with two hidden layers. For an input vector <span class="math inline">\(x\)</span>, weights <span class="math inline">\(W^{(1)}, W^{(2)}, W^{(3)}\)</span> and biases <span class="math inline">\(b^{(1)}, b^{(2)}, b^{(3)}\)</span>, the forward pass is</p>
<p><span class="math display">\[
h^{(1)} = \text{ReLU}(W^{(1)} x + b^{(1)}),\\
h^{(2)} = \text{ReLU}(W^{(2)} h^{(1)} + b^{(2)}),\\
z = W^{(3)} h^{(2)} + b^{(3)},\\
\hat y = \text{softmax}(z),
\]</span></p>
<p>where ReLU is the rectified linear unit activation and softmax converts logits <span class="math inline">\(z\)</span> into class probabilities.</p>
<p>For multi-class classification with one-hot targets <span class="math inline">\(y_i\)</span>, the loss is <strong>categorical cross-entropy</strong></p>
<p><span class="math display">\[
\mathcal{L} = - \sum_{i=1}^n \sum_{k=1}^K y_{ik} \log \hat y_{ik},
\]</span></p>
<p>which is minimized using stochastic gradient descent (or a variant like Adam, as used here). Gradients of the loss with respect to all weights and biases are computed efficiently by <strong>backpropagation</strong>.</p>
<p>The dropout layers randomly zero out a fraction of hidden units during training, which acts as a regularizer by preventing co-adaptation of features and approximating an ensemble of many thinned networks.</p>
<hr>
</section>
</section>
</section>
<section id="model-evaluation-and-tuning" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="model-evaluation-and-tuning"><span class="header-section-number">5.5</span> Model Evaluation and Tuning</h2>
<section id="hyperparameter-tuning" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="hyperparameter-tuning"><span class="header-section-number">5.5.1</span> Hyperparameter Tuning</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid search</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">splitrule =</span> <span class="fu">c</span>(<span class="st">"gini"</span>, <span class="st">"extratrees"</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ranger"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Random search</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ranger"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">20</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">search =</span> <span class="st">"random"</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Best parameters</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>bestTune</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="cross-validation-strategies" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="cross-validation-strategies"><span class="header-section-number">5.5.2</span> Cross-Validation Strategies</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># K-fold CV</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>cv_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeated K-fold</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>cv_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Leave-one-out CV</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>loo_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"LOOCV"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series CV</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ts_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"timeslice"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">initialWindow =</span> <span class="dv">100</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">horizon =</span> <span class="dv">10</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixedWindow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom CV</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(train_data<span class="sc">$</span>Species, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>custom_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">index =</span> folds)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="feature-selection" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="feature-selection"><span class="header-section-number">5.5.3</span> Feature Selection</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive feature elimination</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> rfFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rfe</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  train_data[, <span class="sc">-</span><span class="dv">5</span>],</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  train_data<span class="sc">$</span>Species,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rfeControl =</span> control</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">predictors</span>(results)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"g"</span>, <span class="st">"o"</span>))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Boruta (all-relevant feature selection)</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Boruta)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>boruta_result <span class="ot">&lt;-</span> <span class="fu">Boruta</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">doTrace =</span> <span class="dv">2</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(boruta_result)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boruta_result)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">getSelectedAttributes</span>(boruta_result, <span class="at">withTentative =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="ensemble-methods" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="ensemble-methods"><span class="header-section-number">5.5.4</span> Ensemble Methods</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stacking</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caretEnsemble)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train multiple models</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">caretList</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">methodList =</span> <span class="fu">c</span>(<span class="st">"rf"</span>, <span class="st">"glm"</span>, <span class="st">"knn"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack models</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>stack_model <span class="ot">&lt;-</span> <span class="fu">caretStack</span>(</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  model_list,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">classProbs =</span> <span class="cn">TRUE</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>stack_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(stack_model, test_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="time-series-analysis" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="time-series-analysis"><span class="header-section-number">5.6</span> Time Series Analysis</h2>
<section id="basic-time-series" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="basic-time-series"><span class="header-section-number">5.6.1</span> Basic Time Series</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(AirPassengers, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Decomposition</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>decomp <span class="ot">&lt;-</span> <span class="fu">decompose</span>(ts_data)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(decomp)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># STL decomposition</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>stl_result <span class="ot">&lt;-</span> <span class="fu">stl</span>(ts_data, <span class="at">s.window =</span> <span class="st">"periodic"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stl_result)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="arima-models" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="arima-models"><span class="header-section-number">5.6.2</span> ARIMA Models</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Automatic ARIMA</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_data)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check residuals</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>forecast_result <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> <span class="dv">24</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_result)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual ARIMA</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>fit_manual <span class="ot">&lt;-</span> <span class="fu">arima</span>(ts_data, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Model diagnostics</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tsdiag</span>(fit_manual)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-9" class="level4" data-number="5.6.2.1">
<h4 data-number="5.6.2.1" class="anchored" data-anchor-id="math-and-explanation-9"><span class="header-section-number">5.6.2.1</span> Math and Explanation</h4>
<p>An <span class="math inline">\(\text{ARIMA}(p,d,q)\)</span> model combines <strong>autoregressive (AR)</strong>, <strong>integration (I)</strong>, and <strong>moving-average (MA)</strong> components. Applied to the differenced series</p>
<p><span class="math display">\[
w_t = (1 - B)^d y_t,
\]</span></p>
<p>where <span class="math inline">\(B\)</span> is the backshift operator (<span class="math inline">\(B y_t = y_{t-1}\)</span>), the general form is</p>
<p><span class="math display">\[
\phi(B) w_t = \theta(B) \varepsilon_t,
\]</span></p>
<p>with AR and MA polynomials</p>
<p><span class="math display">\[
\phi(B) = 1 - \phi_1 B - \cdots - \phi_p B^p, \qquad
\theta(B) = 1 + \theta_1 B + \cdots + \theta_q B^q,
\]</span></p>
<p>and innovations <span class="math inline">\(\varepsilon_t \sim \mathcal{N}(0, \sigma^2)\)</span>.</p>
<p>The parameters <span class="math inline">\((\phi_i, \theta_j, d)\)</span> are typically estimated by <strong>maximum likelihood</strong>, which numerically maximizes the probability of the observed time series under the model. <code>auto.arima()</code> searches over candidate <span class="math inline">\((p,d,q)\)</span> values using criteria such as AICc, while <code>checkresiduals()</code> and <code>tsdiag()</code> help verify that the residuals behave like white noise (no remaining structure).</p>
</section>
</section>
<section id="exponential-smoothing" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="exponential-smoothing"><span class="header-section-number">5.6.3</span> Exponential Smoothing</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple exponential smoothing</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fit_ses <span class="ot">&lt;-</span> <span class="fu">ses</span>(ts_data, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt's method (trend)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>fit_holt <span class="ot">&lt;-</span> <span class="fu">holt</span>(ts_data, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt-Winters (trend + seasonality)</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>fit_hw <span class="ot">&lt;-</span> <span class="fu">hw</span>(ts_data, <span class="at">seasonal =</span> <span class="st">"multiplicative"</span>, <span class="at">h =</span> <span class="dv">24</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS (Error, Trend, Seasonal)</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>fit_ets <span class="ot">&lt;-</span> <span class="fu">ets</span>(ts_data)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>forecast_ets <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_ets, <span class="at">h =</span> <span class="dv">24</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_ets)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-10" class="level4" data-number="5.6.3.1">
<h4 data-number="5.6.3.1" class="anchored" data-anchor-id="math-and-explanation-10"><span class="header-section-number">5.6.3.1</span> Math and Explanation</h4>
<p>Exponential smoothing methods describe a time series in terms of recursively updated components for <strong>level</strong>, <strong>trend</strong>, and (optionally) <strong>seasonality</strong>.</p>
<p>For example, <strong>simple exponential smoothing</strong> (no trend or seasonality) uses</p>
<p><span class="math display">\[
\ell_t = \alpha y_t + (1-\alpha)\, \ell_{t-1}, \quad
\hat y_{t+1} = \ell_t,
\]</span></p>
<p>where <span class="math inline">\(\alpha \in (0,1)\)</span> is the smoothing parameter and <span class="math inline">\(\ell_t\)</span> is the smoothed level.</p>
<p>Holt’s method adds a trend component <span class="math inline">\(b_t\)</span> and Holt–Winters adds seasonal components (additive or multiplicative). The <code>ets()</code> function chooses among a family of <strong>Error–Trend–Seasonal (ETS)</strong> state-space models and estimates the smoothing parameters by maximizing the likelihood of one-step-ahead forecast errors.</p>
</section>
</section>
<section id="prophet-facebook" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4" class="anchored" data-anchor-id="prophet-facebook"><span class="header-section-number">5.6.4</span> Prophet (Facebook)</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prophet)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ds =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2020-01-01"</span>), <span class="at">by =</span> <span class="st">"day"</span>, <span class="at">length.out =</span> <span class="dv">365</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">365</span>, <span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">prophet</span>(df)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Make future dataframe</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>future <span class="ot">&lt;-</span> <span class="fu">make_future_dataframe</span>(m, <span class="at">periods =</span> <span class="dv">90</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, future)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, forecast)</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="fu">prophet_plot_components</span>(m, forecast)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<section id="math-and-explanation-11" class="level4" data-number="5.6.4.1">
<h4 data-number="5.6.4.1" class="anchored" data-anchor-id="math-and-explanation-11"><span class="header-section-number">5.6.4.1</span> Math and Explanation</h4>
<p>Prophet models a time series as a sum of interpretable components</p>
<p><span class="math display">\[
y(t) = g(t) + s(t) + h(t) + \varepsilon_t,
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(g(t)\)</span> is a piecewise linear or logistic <strong>trend</strong> with changepoints,</li>
<li><span class="math inline">\(s(t)\)</span> is a <strong>seasonal</strong> component (e.g.&nbsp;yearly, weekly) represented by Fourier series,</li>
<li><span class="math inline">\(h(t)\)</span> captures <strong>holiday or event</strong> effects,</li>
<li><span class="math inline">\(\varepsilon_t\)</span> is an error term.</li>
</ul>
<p>Prophet uses a Bayesian/state-space formulation with priors that encourage smooth trends and reasonable seasonal patterns. Fitting <code>m &lt;- prophet(df)</code> estimates the parameters of these components (trend slopes, changepoints, seasonal amplitudes, holiday effects), and <code>prophet_plot_components()</code> visualizes each component separately so you can interpret how trend, seasonality, and holidays contribute to the observed series.</p>
<hr>
</section>
</section>
</section>
<section id="r-markdown-and-reproducible-research" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="r-markdown-and-reproducible-research"><span class="header-section-number">5.7</span> R Markdown and Reproducible Research</h2>
<section id="basic-r-markdown" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="basic-r-markdown"><span class="header-section-number">5.7.1</span> Basic R Markdown</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "My Analysis"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Your Name"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>This is an R Markdown document.</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: setup, include=FALSE</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="data-analysis" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="data-analysis"><span class="header-section-number">5.8</span> Data Analysis</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: load-data</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualization" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="visualization"><span class="header-section-number">5.9</span> Visualization</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: plot, fig.width=8, fig.height=6</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="conclusion" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">5.10</span> Conclusion</h2>
<p>Results show…</p>
<pre><code>
### Advanced R Markdown Features

```r
# Parameterized reports
---
title: "Parameterized Report"
output: html_document
params:
  year: 2023
  country: "USA"
---

# Inline code
The analysis covers data from `r params$year` in `r params$country`.

# Caching
```r
# chunk: expensive-computation, cache=TRUE
result &lt;- very_long_computation()</code></pre>
</section>
<section id="child-documents" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Child documents</h1>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: child='analysis-section.Rmd'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="tables-with-kable" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Tables with kable</h1>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: r (kable example)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(mtcars), <span class="at">caption =</span> <span class="st">"Motor Trend Cars"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="interactive-tables" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Interactive tables</h1>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: r (DT example)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(mtcars, <span class="at">filter =</span> <span class="st">'top'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<pre><code>
### Output Formats

```r
# PDF output
---
output: pdf_document
---

# Word document
---
output: word_document
---

# Presentation (slides)
---
output: 
  ioslides_presentation:
    widescreen: true
    smaller: true
---

# Dashboard
---
output: flexdashboard::flex_dashboard
---

# Bookdown (books)
---
output: bookdown::gitbook
---</code></pre>
<hr>
<section id="performance-optimization" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="performance-optimization"><span class="header-section-number">8.1</span> Performance Optimization</h2>
<section id="profiling-code" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="profiling-code"><span class="header-section-number">8.1.1</span> Profiling Code</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Profile code execution</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(profvis)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>({</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, data)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Benchmark functions</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">microbenchmark</span>(</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">base =</span> <span class="fu">apply</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">ncol =</span> <span class="dv">100</span>), <span class="dv">1</span>, sum),</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowSums =</span> <span class="fu">rowSums</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">ncol =</span> <span class="dv">100</span>)),</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">100</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="vectorization" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="vectorization"><span class="header-section-number">8.1.2</span> Vectorization</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Slow: loop</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">10000</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) {</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span> i<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast: vectorized</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Using apply family</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Even faster: built-in functions</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>)<span class="sc">^</span><span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="parallel-processing" class="level3" data-number="8.1.3">
<h3 data-number="8.1.3" class="anchored" data-anchor-id="parallel-processing"><span class="header-section-number">8.1.3</span> Parallel Processing</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect cores</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">detectCores</span>()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel lapply</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">4</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">parLapply</span>(cl, <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># foreach with doParallel</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel caret training</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">4</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> iris,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">allowParallel =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="data.table-for-speed" class="level3" data-number="8.1.4">
<h3 data-number="8.1.4" class="anchored" data-anchor-id="data.table-for-speed"><span class="header-section-number">8.1.4</span> data.table for Speed</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data.table</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(mtcars)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast aggregation</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>dt[, .(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg)), by <span class="ot">=</span> cyl]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast joins</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">value =</span> <span class="fu">rnorm</span>(<span class="dv">1000000</span>))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">category =</span> <span class="fu">sample</span>(letters, <span class="dv">1000000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(dt1, id)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(dt2, id)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> dt1[dt2]  <span class="co"># Fast join</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Update by reference</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>dt[, new_col <span class="sc">:</span><span class="er">=</span> mpg <span class="sc">*</span> <span class="dv">2</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="advanced-topics" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="advanced-topics"><span class="header-section-number">8.2</span> Advanced Topics</h2>
<section id="custom-functions-and-debugging" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="custom-functions-and-debugging"><span class="header-section-number">8.2.1</span> Custom Functions and Debugging</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function with error handling</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>safe_divide <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">"Division by zero"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> x <span class="sc">/</span> y</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error: "</span>, e<span class="sc">$</span>message)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">warning =</span> <span class="cf">function</span>(w) {</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Warning: "</span>, w<span class="sc">$</span>message)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Debugging</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="fu">debug</span>(my_function)  <span class="co"># Enter debug mode</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="fu">debugonce</span>(my_function)  <span class="co"># Debug once</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="fu">undebug</span>(my_function)  <span class="co"># Exit debug mode</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Browser</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">browser</span>()  <span class="co"># Pause execution</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> y <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(z)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Assertions</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">is.numeric</span>(x))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="s3-and-s4-classes" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="s3-and-s4-classes"><span class="header-section-number">8.2.2</span> S3 and S4 Classes</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># S3 class</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>person <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">"Alice"</span>, <span class="at">age =</span> <span class="dv">25</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(person) <span class="ot">&lt;-</span> <span class="st">"Person"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>print.Person <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Person:"</span>, x<span class="sc">$</span>name, <span class="st">"Age:"</span>, x<span class="sc">$</span>age, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># S4 class</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Employee"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">list</span>(</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"character"</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="st">"numeric"</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">salary =</span> <span class="st">"numeric"</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>emp <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"Employee"</span>, <span class="at">name =</span> <span class="st">"Bob"</span>, <span class="at">age =</span> <span class="dv">30</span>, <span class="at">salary =</span> <span class="dv">50000</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Methods</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"getSalary"</span>, <span class="cf">function</span>(obj) <span class="fu">standardGeneric</span>(<span class="st">"getSalary"</span>))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"getSalary"</span>, <span class="st">"Employee"</span>, <span class="cf">function</span>(obj) obj<span class="sc">@</span>salary)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="writing-packages" class="level3" data-number="8.2.3">
<h3 data-number="8.2.3" class="anchored" data-anchor-id="writing-packages"><span class="header-section-number">8.2.3</span> Writing Packages</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create package structure</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="st">"mypackage"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add function</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"my_function"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add documentation with roxygen2</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' Add Two Numbers</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x A number</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param y A number</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return The sum of x and y</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' add_numbers(2, 3)</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>add_numbers <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate documentation</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add tests</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"my_function"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Check package</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Install</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="practice-projects" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="practice-projects"><span class="header-section-number">8.3</span> Practice Projects</h2>
<section id="project-1-predictive-modeling-pipeline" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="project-1-predictive-modeling-pipeline"><span class="header-section-number">8.3.1</span> Project 1: Predictive Modeling Pipeline</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load and prepare data</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Split data</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris<span class="sc">$</span>Species, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> iris[trainIndex, ]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> iris[<span class="sc">-</span>trainIndex, ]</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Preprocessing</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>preprocess_params <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(train_data[, <span class="sc">-</span><span class="dv">5</span>], <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>train_processed <span class="ot">&lt;-</span> <span class="fu">predict</span>(preprocess_params, train_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>test_processed <span class="ot">&lt;-</span> <span class="fu">predict</span>(preprocess_params, test_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Train multiple models</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> <span class="fu">train</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"rf"</span>),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">svm =</span> <span class="fu">train</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"svmRadial"</span>),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">gbm =</span> <span class="fu">train</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"gbm"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Evaluate</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, test_data)</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">confusionMatrix</span>(pred, test_data<span class="sc">$</span>Species)</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Select best model</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>accuracies <span class="ot">&lt;-</span> <span class="fu">sapply</span>(results, <span class="cf">function</span>(r) r<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>])</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> models[[<span class="fu">which.max</span>(accuracies)]]</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Save model</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(best_model, <span class="st">"best_model.rds"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="project-2-time-series-forecasting" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="project-2-time-series-forecasting"><span class="header-section-number">8.3.2</span> Project 2: Time Series Forecasting</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load data</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(AirPassengers, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Split train/test</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_data, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1958</span>, <span class="dv">12</span>))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_data, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1959</span>, <span class="dv">1</span>))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit multiple models</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">arima =</span> <span class="fu">auto.arima</span>(train),</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ets =</span> <span class="fu">ets</span>(train),</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">tbats =</span> <span class="fu">tbats</span>(train)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Forecast</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>forecasts <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models, forecast, <span class="at">h =</span> <span class="fu">length</span>(test))</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Evaluate</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>accuracy_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(forecasts, <span class="cf">function</span>(f) {</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(f, test)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Visualize</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(forecasts)) {</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(forecasts[[i]], <span class="at">main =</span> <span class="fu">names</span>(forecasts)[i])</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(test, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="summary" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="summary"><span class="header-section-number">8.4</span> Summary</h2>
<section id="skills-mastered" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="skills-mastered"><span class="header-section-number">8.4.1</span> Skills Mastered</h3>
<ul>
<li>✅ Statistical modeling (linear, logistic, GLM, mixed models)</li>
<li>✅ Machine learning with caret and advanced algorithms</li>
<li>✅ Model evaluation, tuning, and ensemble methods</li>
<li>✅ Time series analysis and forecasting</li>
<li>✅ R Markdown for reproducible research</li>
<li>✅ Performance optimization and parallel processing</li>
<li>✅ Advanced R programming concepts</li>
</ul>
</section>
<section id="next-steps" class="level3" data-number="8.4.2">
<h3 data-number="8.4.2" class="anchored" data-anchor-id="next-steps"><span class="header-section-number">8.4.2</span> Next Steps</h3>
<ol type="1">
<li><strong>Build:</strong> Create end-to-end ML projects</li>
<li><strong>Explore:</strong> Shiny apps (<code>4_Shiny_Apps_in_R.md</code>)</li>
<li><strong>Develop:</strong> R packages and developer tools</li>
<li><strong>Publish:</strong> Share analyses on RPubs, GitHub</li>
</ol>
<p><strong>Continue to Shiny Apps! 🚀</strong></p>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./2_Intermediate_Level_R.html" class="pagination-link" aria-label="Intermediate Level R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Intermediate Level R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./4_Shiny_Apps_in_R.html" class="pagination-link" aria-label="Shiny Apps in R">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Shiny Apps in R</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Expert Level R</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Table of Contents</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="co">[</span><span class="ot">Statistical Modeling</span><span class="co">](#statistical-modeling)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="co">[</span><span class="ot">Machine Learning with caret</span><span class="co">](#machine-learning-with-caret)</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span><span class="co">[</span><span class="ot">Advanced ML Algorithms</span><span class="co">](#advanced-ml-algorithms)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="co">[</span><span class="ot">Model Evaluation and Tuning</span><span class="co">](#model-evaluation-and-tuning)</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span><span class="co">[</span><span class="ot">Time Series Analysis</span><span class="co">](#time-series-analysis)</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span><span class="co">[</span><span class="ot">R Markdown and Reproducible Research</span><span class="co">](#r-markdown)</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span><span class="co">[</span><span class="ot">Performance Optimization</span><span class="co">](#performance-optimization)</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span><span class="co">[</span><span class="ot">Advanced Topics</span><span class="co">](#advanced-topics)</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statistical Modeling</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear Regression</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple linear regression</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple regression</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> hp <span class="sc">+</span> cyl, <span class="at">data =</span> mtcars)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">wt =</span> <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">3.0</span>, <span class="fl">3.5</span>), <span class="at">hp =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">140</span>), <span class="at">cyl =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, new_data, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Model diagnostics</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Check assumptions</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model)  <span class="co"># Variance Inflation Factor (multicollinearity)</span></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="fu">durbinWatsonTest</span>(model)  <span class="co"># Autocorrelation</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(model)  <span class="co"># Heteroscedasticity</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual analysis</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> <span class="fu">resid</span>(model)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(residuals)  <span class="co"># Normality test</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>We observe a response $y_i$ and $p$ predictors $x_{i1},\dots,x_{ip}$ for $i = 1,\dots,n$. Linear regression assumes the conditional mean of $Y$ is a linear function of the predictors:</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>y_i = \beta_0 + \beta_1 x_{i1} + \cdots + \beta_p x_{ip} + \varepsilon_i,</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>or in matrix form</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>\mathbf{y} = X\beta + \varepsilon,</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>where $X$ is the $n \times (p+1)$ design matrix (including a column of ones for the intercept), $\beta$ is the vector of coefficients, and $\varepsilon$ is an error term (often modeled as $\varepsilon \sim \mathcal{N}(0, \sigma^2 I)$).</span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>The **ordinary least squares (OLS)** estimator chooses $\hat\beta$ to minimize the sum of squared residuals:</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>\hat\beta = \arg\min_\beta \sum_{i=1}^n (y_i - \hat y_i)^2</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>            = \arg\min_\beta \lVert \mathbf{y} - X\beta \rVert_2^2.</span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>When $X^\top X$ is invertible, the minimizer has the closed form</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>\hat\beta = (X^\top X)^{-1} X^\top \mathbf{y}.</span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>The diagnostic code (residual plots, variance inflation factor, Durbin–Watson test, tests for heteroscedasticity and normality) is checking whether the usual assumptions—linearity, independence, constant variance, and approximately normal residuals—are reasonable for this model.</span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic Regression</span></span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Binary classification</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>iris_binary <span class="ot">&lt;-</span> iris[iris<span class="sc">$</span>Species <span class="sc">!=</span> <span class="st">"setosa"</span>, ]</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>iris_binary<span class="sc">$</span>Species <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(iris_binary<span class="sc">$</span>Species)</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Species <span class="sc">~</span> Sepal.Length <span class="sc">+</span> Sepal.Width, </span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> iris_binary, </span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>predicted_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"virginica"</span>, <span class="st">"versicolor"</span>)</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Predicted =</span> predicted_class, <span class="at">Actual =</span> iris_binary<span class="sc">$</span>Species)</span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC curve and AUC</span></span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(iris_binary<span class="sc">$</span>Species, predictions)</span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_obj, <span class="at">main =</span> <span class="st">"ROC Curve"</span>)</span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a><span class="fu">auc</span>(roc_obj)</span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Odds ratios</span></span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model))</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(model))</span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>For a binary response $Y \in <span class="sc">\{</span>0,1<span class="sc">\}</span>$ and predictors $x$, logistic regression models the conditional probability of the positive class as</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a>P(Y = 1 \mid x) = p(x) = \sigma(\eta) = \frac{1}{1 + e^{-\eta}}, \quad \eta = \beta_0 + \beta^\top x.</span>
<span id="cb38-113"><a href="#cb38-113" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-114"><a href="#cb38-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-115"><a href="#cb38-115" aria-hidden="true" tabindex="-1"></a>Equivalently, the **log-odds** (logit) are linear in the predictors:</span>
<span id="cb38-116"><a href="#cb38-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-117"><a href="#cb38-117" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-118"><a href="#cb38-118" aria-hidden="true" tabindex="-1"></a>\log\frac{p(x)}{1 - p(x)} = \beta_0 + \beta^\top x.</span>
<span id="cb38-119"><a href="#cb38-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-120"><a href="#cb38-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-121"><a href="#cb38-121" aria-hidden="true" tabindex="-1"></a>Given data $(x_i, y_i)$, $i = 1,\dots,n$, the likelihood of the parameters $\beta$ is</span>
<span id="cb38-122"><a href="#cb38-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-123"><a href="#cb38-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-124"><a href="#cb38-124" aria-hidden="true" tabindex="-1"></a>L(\beta) = \prod_{i=1}^n p(x_i)^{y_i} <span class="co">[</span><span class="ot">1 - p(x_i)</span><span class="co">]</span>^{1-y_i},</span>
<span id="cb38-125"><a href="#cb38-125" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-126"><a href="#cb38-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-127"><a href="#cb38-127" aria-hidden="true" tabindex="-1"></a>with log-likelihood</span>
<span id="cb38-128"><a href="#cb38-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-129"><a href="#cb38-129" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-130"><a href="#cb38-130" aria-hidden="true" tabindex="-1"></a>\ell(\beta) = \sum_{i=1}^n \big<span class="co">[</span><span class="ot"> y_i \log p(x_i) + (1-y_i) \log(1-p(x_i)) \big</span><span class="co">]</span>.</span>
<span id="cb38-131"><a href="#cb38-131" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-132"><a href="#cb38-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-133"><a href="#cb38-133" aria-hidden="true" tabindex="-1"></a>The fitted coefficients $\hat\beta$ **maximize** $\ell(\beta)$ (or minimize the negative log-likelihood, a cross-entropy loss). There is no closed-form solution, so numerical methods such as iteratively reweighted least squares or gradient-based optimization are used.</span>
<span id="cb38-134"><a href="#cb38-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-135"><a href="#cb38-135" aria-hidden="true" tabindex="-1"></a>Each coefficient $\beta_j$ represents the change in **log-odds** of $Y=1$ for a one-unit increase in $x_j$, holding other predictors fixed. Exponentiating gives an **odds ratio** $e^{\beta_j}$, which is what <span class="in">`exp(coef(model))`</span> and <span class="in">`exp(confint(model))`</span> report. The ROC curve and AUC summarize how well the predicted probabilities separate the two classes over all possible thresholds.</span>
<span id="cb38-136"><a href="#cb38-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-137"><a href="#cb38-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generalized Linear Models (GLM)</span></span>
<span id="cb38-138"><a href="#cb38-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-139"><a href="#cb38-139" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-140"><a href="#cb38-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson regression (count data)</span></span>
<span id="cb38-141"><a href="#cb38-141" aria-hidden="true" tabindex="-1"></a>model_poisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(count <span class="sc">~</span> factor1 <span class="sc">+</span> factor2, </span>
<span id="cb38-142"><a href="#cb38-142" aria-hidden="true" tabindex="-1"></a>                     <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb38-143"><a href="#cb38-143" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> df)</span>
<span id="cb38-144"><a href="#cb38-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-145"><a href="#cb38-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative binomial (overdispersed count data)</span></span>
<span id="cb38-146"><a href="#cb38-146" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb38-147"><a href="#cb38-147" aria-hidden="true" tabindex="-1"></a>model_nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(count <span class="sc">~</span> factor1 <span class="sc">+</span> factor2, <span class="at">data =</span> df)</span>
<span id="cb38-148"><a href="#cb38-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-149"><a href="#cb38-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Gamma regression (continuous positive data)</span></span>
<span id="cb38-150"><a href="#cb38-150" aria-hidden="true" tabindex="-1"></a>model_gamma <span class="ot">&lt;-</span> <span class="fu">glm</span>(response <span class="sc">~</span> predictor, </span>
<span id="cb38-151"><a href="#cb38-151" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">Gamma</span>(<span class="at">link =</span> <span class="st">"log"</span>),</span>
<span id="cb38-152"><a href="#cb38-152" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> df)</span>
<span id="cb38-153"><a href="#cb38-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-154"><a href="#cb38-154" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-155"><a href="#cb38-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-156"><a href="#cb38-156" aria-hidden="true" tabindex="-1"></a>Generalized linear models extend linear regression to non-Gaussian response distributions from the **exponential family**. For observation $i$ we write</span>
<span id="cb38-157"><a href="#cb38-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-158"><a href="#cb38-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-159"><a href="#cb38-159" aria-hidden="true" tabindex="-1"></a>g(\mu_i) = \eta_i = x_i^\top \beta, \quad \mu_i = \mathbb{E}<span class="co">[</span><span class="ot">Y_i \mid x_i</span><span class="co">]</span>,</span>
<span id="cb38-160"><a href="#cb38-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-161"><a href="#cb38-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-162"><a href="#cb38-162" aria-hidden="true" tabindex="-1"></a>where $g(\cdot)$ is a link function and $\mu_i$ is the conditional mean of $Y_i$.</span>
<span id="cb38-163"><a href="#cb38-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-164"><a href="#cb38-164" aria-hidden="true" tabindex="-1"></a>In this code:</span>
<span id="cb38-165"><a href="#cb38-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-166"><a href="#cb38-166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Poisson regression** assumes $Y_i \sim \text{Poisson}(\lambda_i)$ for count data and uses the log link</span>
<span id="cb38-167"><a href="#cb38-167" aria-hidden="true" tabindex="-1"></a>  $$\log(\lambda_i) = x_i^\top \beta.$$</span>
<span id="cb38-168"><a href="#cb38-168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Negative binomial regression** also models counts but introduces an additional dispersion parameter to handle overdispersion (variance greater than the mean), again with a log link.</span>
<span id="cb38-169"><a href="#cb38-169" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gamma regression** assumes $Y_i$ is positive and continuous and often uses a log link</span>
<span id="cb38-170"><a href="#cb38-170" aria-hidden="true" tabindex="-1"></a>  $$\log(\mu_i) = x_i^\top \beta.$$</span>
<span id="cb38-171"><a href="#cb38-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-172"><a href="#cb38-172" aria-hidden="true" tabindex="-1"></a>The parameters $\beta$ are estimated by **maximum likelihood**, i.e.</span>
<span id="cb38-173"><a href="#cb38-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-174"><a href="#cb38-174" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-175"><a href="#cb38-175" aria-hidden="true" tabindex="-1"></a>\hat\beta = \arg\max_\beta \; \ell(\beta),</span>
<span id="cb38-176"><a href="#cb38-176" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-177"><a href="#cb38-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-178"><a href="#cb38-178" aria-hidden="true" tabindex="-1"></a>where $\ell(\beta)$ is the log-likelihood implied by the chosen distribution and link. In practice, <span class="in">`glm()`</span> uses **iteratively reweighted least squares (IRLS)** to solve this optimization by repeatedly fitting weighted least-squares regressions until convergence.</span>
<span id="cb38-179"><a href="#cb38-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-180"><a href="#cb38-180" aria-hidden="true" tabindex="-1"></a>Diagnostics for GLMs focus on whether the chosen distribution and link adequately capture the mean–variance relationship (e.g. checking residuals, deviance, and overdispersion for Poisson models).</span>
<span id="cb38-181"><a href="#cb38-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-182"><a href="#cb38-182" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mixed Effects Models</span></span>
<span id="cb38-183"><a href="#cb38-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-184"><a href="#cb38-184" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-185"><a href="#cb38-185" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb38-186"><a href="#cb38-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-187"><a href="#cb38-187" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear mixed model</span></span>
<span id="cb38-188"><a href="#cb38-188" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(reaction <span class="sc">~</span> days <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> days <span class="sc">|</span> subject), <span class="at">data =</span> sleepstudy)</span>
<span id="cb38-189"><a href="#cb38-189" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb38-190"><a href="#cb38-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-191"><a href="#cb38-191" aria-hidden="true" tabindex="-1"></a><span class="co"># Random intercept and slope</span></span>
<span id="cb38-192"><a href="#cb38-192" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (x <span class="sc">|</span> group), <span class="at">data =</span> df)</span>
<span id="cb38-193"><a href="#cb38-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-194"><a href="#cb38-194" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract random effects</span></span>
<span id="cb38-195"><a href="#cb38-195" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(model)</span>
<span id="cb38-196"><a href="#cb38-196" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(model)</span>
<span id="cb38-197"><a href="#cb38-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-198"><a href="#cb38-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Model comparison</span></span>
<span id="cb38-199"><a href="#cb38-199" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> group), <span class="at">data =</span> df)</span>
<span id="cb38-200"><a href="#cb38-200" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> x <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> x <span class="sc">|</span> group), <span class="at">data =</span> df)</span>
<span id="cb38-201"><a href="#cb38-201" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span>
<span id="cb38-202"><a href="#cb38-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-203"><a href="#cb38-203" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-204"><a href="#cb38-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-205"><a href="#cb38-205" aria-hidden="true" tabindex="-1"></a>Mixed effects (multilevel) models include both **fixed effects**, which are shared across all groups, and **random effects**, which capture group-specific deviations.</span>
<span id="cb38-206"><a href="#cb38-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-207"><a href="#cb38-207" aria-hidden="true" tabindex="-1"></a>A simple linear mixed model for observation $i$ in group $j$ can be written as</span>
<span id="cb38-208"><a href="#cb38-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-209"><a href="#cb38-209" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-210"><a href="#cb38-210" aria-hidden="true" tabindex="-1"></a>y_{ij} = \beta_0 + \beta^\top x_{ij} + b_{0j} + b_j^\top z_{ij} + \varepsilon_{ij},</span>
<span id="cb38-211"><a href="#cb38-211" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-212"><a href="#cb38-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-213"><a href="#cb38-213" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb38-214"><a href="#cb38-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-215"><a href="#cb38-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta$ are fixed-effect coefficients,</span>
<span id="cb38-216"><a href="#cb38-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$b_j$ are random effects for group $j$ (typically $b_j \sim \mathcal{N}(0, \Sigma_b)$),</span>
<span id="cb38-217"><a href="#cb38-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$z_{ij}$ selects which random effects apply to observation $ij$,</span>
<span id="cb38-218"><a href="#cb38-218" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\varepsilon_{ij} \sim \mathcal{N}(0, \sigma^2)$ are residual errors.</span>
<span id="cb38-219"><a href="#cb38-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-220"><a href="#cb38-220" aria-hidden="true" tabindex="-1"></a>Formulas like <span class="in">`reaction ~ days + (1 + days | subject)`</span> tell <span class="in">`lmer()`</span> to include a fixed effect of <span class="in">`days`</span> plus random intercepts and random slopes by <span class="in">`subject`</span>.</span>
<span id="cb38-221"><a href="#cb38-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-222"><a href="#cb38-222" aria-hidden="true" tabindex="-1"></a>Estimation proceeds by maximizing the **(restricted) marginal likelihood** obtained by integrating out the random effects:</span>
<span id="cb38-223"><a href="#cb38-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-224"><a href="#cb38-224" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-225"><a href="#cb38-225" aria-hidden="true" tabindex="-1"></a>L(\beta, \Sigma_b, \sigma^2) = \prod_j \int f(y_j \mid b_j, \beta, \sigma^2) f(b_j \mid \Sigma_b)\, db_j.</span>
<span id="cb38-226"><a href="#cb38-226" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-227"><a href="#cb38-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-228"><a href="#cb38-228" aria-hidden="true" tabindex="-1"></a><span class="in">`lme4`</span> uses numerical methods (Laplace approximation, sparse linear algebra) to approximate this likelihood efficiently. The <span class="in">`anova(model1, model2)`</span> call is performing a likelihood-ratio test between nested mixed-effect models to assess whether the more complex random-effect structure significantly improves model fit.</span>
<span id="cb38-229"><a href="#cb38-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-230"><a href="#cb38-230" aria-hidden="true" tabindex="-1"></a><span class="fu">### Survival Analysis</span></span>
<span id="cb38-231"><a href="#cb38-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-232"><a href="#cb38-232" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-233"><a href="#cb38-233" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb38-234"><a href="#cb38-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-235"><a href="#cb38-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Kaplan-Meier survival curve</span></span>
<span id="cb38-236"><a href="#cb38-236" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> group, <span class="at">data =</span> lung)</span>
<span id="cb38-237"><a href="#cb38-237" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb38-238"><a href="#cb38-238" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Survival Probability"</span>)</span>
<span id="cb38-239"><a href="#cb38-239" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Group 1"</span>, <span class="st">"Group 2"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb38-240"><a href="#cb38-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-241"><a href="#cb38-241" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-rank test</span></span>
<span id="cb38-242"><a href="#cb38-242" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> group, <span class="at">data =</span> lung)</span>
<span id="cb38-243"><a href="#cb38-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-244"><a href="#cb38-244" aria-hidden="true" tabindex="-1"></a><span class="co"># Cox proportional hazards model</span></span>
<span id="cb38-245"><a href="#cb38-245" aria-hidden="true" tabindex="-1"></a>cox_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> ph.ecog, <span class="at">data =</span> lung)</span>
<span id="cb38-246"><a href="#cb38-246" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cox_model)</span>
<span id="cb38-247"><a href="#cb38-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-248"><a href="#cb38-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Hazard ratios</span></span>
<span id="cb38-249"><a href="#cb38-249" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(cox_model))</span>
<span id="cb38-250"><a href="#cb38-250" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">confint</span>(cox_model))</span>
<span id="cb38-251"><a href="#cb38-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-252"><a href="#cb38-252" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-253"><a href="#cb38-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-254"><a href="#cb38-254" aria-hidden="true" tabindex="-1"></a>Let $T$ be a time-to-event random variable. Two key functions in survival analysis are:</span>
<span id="cb38-255"><a href="#cb38-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-256"><a href="#cb38-256" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Survival function**: $S(t) = P(T &gt; t)$.</span>
<span id="cb38-257"><a href="#cb38-257" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Hazard function**: $h(t) = \lim_{\Delta t \to 0} P(t \le T &lt; t + \Delta t \mid T \ge t)/\Delta t$.</span>
<span id="cb38-258"><a href="#cb38-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-259"><a href="#cb38-259" aria-hidden="true" tabindex="-1"></a>The Kaplan–Meier estimator used by <span class="in">`survfit()`</span> estimates $S(t)$ nonparametrically by multiplying conditional survival probabilities at each observed event time.</span>
<span id="cb38-260"><a href="#cb38-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-261"><a href="#cb38-261" aria-hidden="true" tabindex="-1"></a>The **Cox proportional hazards model** assumes that the hazard for subject $i$ with covariates $x_i$ is</span>
<span id="cb38-262"><a href="#cb38-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-263"><a href="#cb38-263" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-264"><a href="#cb38-264" aria-hidden="true" tabindex="-1"></a>h(t \mid x_i) = h_0(t) \exp(\beta^\top x_i),</span>
<span id="cb38-265"><a href="#cb38-265" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-266"><a href="#cb38-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-267"><a href="#cb38-267" aria-hidden="true" tabindex="-1"></a>where $h_0(t)$ is an unspecified baseline hazard and $\beta$ are regression coefficients.</span>
<span id="cb38-268"><a href="#cb38-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-269"><a href="#cb38-269" aria-hidden="true" tabindex="-1"></a>Instead of a full likelihood, Cox regression maximizes the **partial likelihood**</span>
<span id="cb38-270"><a href="#cb38-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-271"><a href="#cb38-271" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-272"><a href="#cb38-272" aria-hidden="true" tabindex="-1"></a>L_p(\beta) = \prod_{i \in \mathcal{D}} \frac{\exp(\beta^\top x_i)}{\sum_{j \in R_i} \exp(\beta^\top x_j)},</span>
<span id="cb38-273"><a href="#cb38-273" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-274"><a href="#cb38-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-275"><a href="#cb38-275" aria-hidden="true" tabindex="-1"></a>where $\mathcal{D}$ is the set of event times and $R_i$ is the risk set at the time of event $i$. Maximizing $L_p(\beta)$ yields estimates $\hat\beta$, and</span>
<span id="cb38-276"><a href="#cb38-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-277"><a href="#cb38-277" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-278"><a href="#cb38-278" aria-hidden="true" tabindex="-1"></a>\exp(\beta_j)</span>
<span id="cb38-279"><a href="#cb38-279" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-280"><a href="#cb38-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-281"><a href="#cb38-281" aria-hidden="true" tabindex="-1"></a>is interpreted as a **hazard ratio**: the multiplicative change in hazard for a one-unit increase in covariate $x_j$.</span>
<span id="cb38-282"><a href="#cb38-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-283"><a href="#cb38-283" aria-hidden="true" tabindex="-1"></a>The log-rank test compares two (or more) survival curves under the null hypothesis that their hazard functions are equal over time.</span>
<span id="cb38-284"><a href="#cb38-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-285"><a href="#cb38-285" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-286"><a href="#cb38-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-287"><a href="#cb38-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Machine Learning with caret</span></span>
<span id="cb38-288"><a href="#cb38-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-289"><a href="#cb38-289" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup and Data Splitting</span></span>
<span id="cb38-290"><a href="#cb38-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-291"><a href="#cb38-291" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-292"><a href="#cb38-292" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb38-293"><a href="#cb38-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-294"><a href="#cb38-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data</span></span>
<span id="cb38-295"><a href="#cb38-295" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-296"><a href="#cb38-296" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris<span class="sc">$</span>Species, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-297"><a href="#cb38-297" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> iris[trainIndex, ]</span>
<span id="cb38-298"><a href="#cb38-298" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> iris[<span class="sc">-</span>trainIndex, ]</span>
<span id="cb38-299"><a href="#cb38-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-300"><a href="#cb38-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Cross-validation setup</span></span>
<span id="cb38-301"><a href="#cb38-301" aria-hidden="true" tabindex="-1"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb38-302"><a href="#cb38-302" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb38-303"><a href="#cb38-303" aria-hidden="true" tabindex="-1"></a>  <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb38-304"><a href="#cb38-304" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb38-305"><a href="#cb38-305" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-306"><a href="#cb38-306" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction =</span> multiClassSummary</span>
<span id="cb38-307"><a href="#cb38-307" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-308"><a href="#cb38-308" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-309"><a href="#cb38-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-310"><a href="#cb38-310" aria-hidden="true" tabindex="-1"></a><span class="fu">### Training Models</span></span>
<span id="cb38-311"><a href="#cb38-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-312"><a href="#cb38-312" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-313"><a href="#cb38-313" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb38-314"><a href="#cb38-314" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-315"><a href="#cb38-315" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-316"><a href="#cb38-316" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-317"><a href="#cb38-317" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-318"><a href="#cb38-318" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb38-319"><a href="#cb38-319" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-320"><a href="#cb38-320" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">5</span></span>
<span id="cb38-321"><a href="#cb38-321" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-322"><a href="#cb38-322" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span>
<span id="cb38-323"><a href="#cb38-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-324"><a href="#cb38-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Support Vector Machine</span></span>
<span id="cb38-325"><a href="#cb38-325" aria-hidden="true" tabindex="-1"></a>svm_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-326"><a href="#cb38-326" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-327"><a href="#cb38-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-328"><a href="#cb38-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"svmRadial"</span>,</span>
<span id="cb38-329"><a href="#cb38-329" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-330"><a href="#cb38-330" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">5</span></span>
<span id="cb38-331"><a href="#cb38-331" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-332"><a href="#cb38-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-333"><a href="#cb38-333" aria-hidden="true" tabindex="-1"></a><span class="co"># Gradient Boosting</span></span>
<span id="cb38-334"><a href="#cb38-334" aria-hidden="true" tabindex="-1"></a>gbm_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-335"><a href="#cb38-335" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-336"><a href="#cb38-336" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-337"><a href="#cb38-337" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"gbm"</span>,</span>
<span id="cb38-338"><a href="#cb38-338" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-339"><a href="#cb38-339" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb38-340"><a href="#cb38-340" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-341"><a href="#cb38-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-342"><a href="#cb38-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Neural Network</span></span>
<span id="cb38-343"><a href="#cb38-343" aria-hidden="true" tabindex="-1"></a>nnet_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-344"><a href="#cb38-344" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-345"><a href="#cb38-345" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-346"><a href="#cb38-346" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"nnet"</span>,</span>
<span id="cb38-347"><a href="#cb38-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-348"><a href="#cb38-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace =</span> <span class="cn">FALSE</span></span>
<span id="cb38-349"><a href="#cb38-349" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-350"><a href="#cb38-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-351"><a href="#cb38-351" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-352"><a href="#cb38-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-353"><a href="#cb38-353" aria-hidden="true" tabindex="-1"></a>Although <span class="in">`caret::train()`</span> hides the underlying optimization details, each <span class="in">`method`</span> corresponds to a specific model class and loss function:</span>
<span id="cb38-354"><a href="#cb38-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-355"><a href="#cb38-355" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Random Forest (`method = "rf"`)**</span>
<span id="cb38-356"><a href="#cb38-356" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>An ensemble of decision trees $<span class="sc">\{</span>T_b(x)\}_{b=1}^B$ grown on bootstrap samples.</span>
<span id="cb38-357"><a href="#cb38-357" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>For classification, the prediction is the **majority vote** of the trees.</span>
<span id="cb38-358"><a href="#cb38-358" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Each split in a tree greedily chooses the feature and split point that maximizes decrease in node impurity (e.g. Gini index</span>
<span id="cb38-359"><a href="#cb38-359" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-360"><a href="#cb38-360" aria-hidden="true" tabindex="-1"></a>    G = \sum_k p_k(1-p_k),</span>
<span id="cb38-361"><a href="#cb38-361" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-362"><a href="#cb38-362" aria-hidden="true" tabindex="-1"></a>    where $p_k$ is the class proportion in that node).</span>
<span id="cb38-363"><a href="#cb38-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-364"><a href="#cb38-364" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Support Vector Machine (`method = "svmRadial"`)**</span>
<span id="cb38-365"><a href="#cb38-365" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Finds a separating surface with maximum margin. In the soft-margin formulation it solves</span>
<span id="cb38-366"><a href="#cb38-366" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-367"><a href="#cb38-367" aria-hidden="true" tabindex="-1"></a>    \min_{w,b,\xi} \; \tfrac{1}{2}\lVert w \rVert^2 + C \sum_{i=1}^n \xi_i</span>
<span id="cb38-368"><a href="#cb38-368" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-369"><a href="#cb38-369" aria-hidden="true" tabindex="-1"></a>    subject to</span>
<span id="cb38-370"><a href="#cb38-370" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-371"><a href="#cb38-371" aria-hidden="true" tabindex="-1"></a>    y_i (w^T \phi(x_i) + b) \ge 1 - \xi_i, \quad \xi_i \ge 0,</span>
<span id="cb38-372"><a href="#cb38-372" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-373"><a href="#cb38-373" aria-hidden="true" tabindex="-1"></a>    where $\phi(\cdot)$ is induced by the RBF kernel and $C$ controls the penalty for misclassification.</span>
<span id="cb38-374"><a href="#cb38-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-375"><a href="#cb38-375" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gradient Boosting (`method = "gbm"`)**</span>
<span id="cb38-376"><a href="#cb38-376" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Builds an additive model of weak learners</span>
<span id="cb38-377"><a href="#cb38-377" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-378"><a href="#cb38-378" aria-hidden="true" tabindex="-1"></a>    F_M(x) = \sum_{m=1}^M \gamma_m h_m(x),</span>
<span id="cb38-379"><a href="#cb38-379" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-380"><a href="#cb38-380" aria-hidden="true" tabindex="-1"></a>    where each new tree $h_m$ is fit to approximate the **negative gradient** of the loss with respect to the current predictions.</span>
<span id="cb38-381"><a href="#cb38-381" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>This is a stagewise functional gradient descent procedure that iteratively reduces training loss.</span>
<span id="cb38-382"><a href="#cb38-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-383"><a href="#cb38-383" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Neural Network (`method = "nnet"`)**</span>
<span id="cb38-384"><a href="#cb38-384" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Typically a single hidden layer with non-linear activation:</span>
<span id="cb38-385"><a href="#cb38-385" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-386"><a href="#cb38-386" aria-hidden="true" tabindex="-1"></a>    h = \sigma(W^{(1)} x + b^{(1)}), \quad \hat y = f(W^{(2)} h + b^{(2)}),</span>
<span id="cb38-387"><a href="#cb38-387" aria-hidden="true" tabindex="-1"></a>    $$</span>
<span id="cb38-388"><a href="#cb38-388" aria-hidden="true" tabindex="-1"></a>    where $\sigma$ is an activation (e.g. logistic, ReLU) and $f$ is softmax (classification) or identity (regression).</span>
<span id="cb38-389"><a href="#cb38-389" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Training minimizes a loss such as cross-entropy using gradient descent and backpropagation.</span>
<span id="cb38-390"><a href="#cb38-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-391"><a href="#cb38-391" aria-hidden="true" tabindex="-1"></a><span class="in">`caret`</span> handles resampling (cross-validation), hyperparameter tuning, and calling the appropriate underlying algorithms, but the optimization for each model follows these mathematical objectives.</span>
<span id="cb38-392"><a href="#cb38-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-393"><a href="#cb38-393" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predictions and Evaluation</span></span>
<span id="cb38-394"><a href="#cb38-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-395"><a href="#cb38-395" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-396"><a href="#cb38-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb38-397"><a href="#cb38-397" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data)</span>
<span id="cb38-398"><a href="#cb38-398" aria-hidden="true" tabindex="-1"></a>svm_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model, test_data)</span>
<span id="cb38-399"><a href="#cb38-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-400"><a href="#cb38-400" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion Matrix</span></span>
<span id="cb38-401"><a href="#cb38-401" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(rf_pred, test_data<span class="sc">$</span>Species)</span>
<span id="cb38-402"><a href="#cb38-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-403"><a href="#cb38-403" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple metrics</span></span>
<span id="cb38-404"><a href="#cb38-404" aria-hidden="true" tabindex="-1"></a><span class="fu">postResample</span>(rf_pred, test_data<span class="sc">$</span>Species)</span>
<span id="cb38-405"><a href="#cb38-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-406"><a href="#cb38-406" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb38-407"><a href="#cb38-407" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(rf_model)</span>
<span id="cb38-408"><a href="#cb38-408" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">varImp</span>(rf_model), <span class="at">top =</span> <span class="dv">10</span>)</span>
<span id="cb38-409"><a href="#cb38-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-410"><a href="#cb38-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-411"><a href="#cb38-411" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Comparison</span></span>
<span id="cb38-412"><a href="#cb38-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-413"><a href="#cb38-413" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-414"><a href="#cb38-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare multiple models</span></span>
<span id="cb38-415"><a href="#cb38-415" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">resamples</span>(<span class="fu">list</span>(</span>
<span id="cb38-416"><a href="#cb38-416" aria-hidden="true" tabindex="-1"></a>  <span class="at">RF =</span> rf_model,</span>
<span id="cb38-417"><a href="#cb38-417" aria-hidden="true" tabindex="-1"></a>  <span class="at">SVM =</span> svm_model,</span>
<span id="cb38-418"><a href="#cb38-418" aria-hidden="true" tabindex="-1"></a>  <span class="at">GBM =</span> gbm_model,</span>
<span id="cb38-419"><a href="#cb38-419" aria-hidden="true" tabindex="-1"></a>  <span class="at">NNET =</span> nnet_model</span>
<span id="cb38-420"><a href="#cb38-420" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb38-421"><a href="#cb38-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-422"><a href="#cb38-422" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(results)</span>
<span id="cb38-423"><a href="#cb38-423" aria-hidden="true" tabindex="-1"></a><span class="fu">dotplot</span>(results)</span>
<span id="cb38-424"><a href="#cb38-424" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(results)</span>
<span id="cb38-425"><a href="#cb38-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-426"><a href="#cb38-426" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistical test</span></span>
<span id="cb38-427"><a href="#cb38-427" aria-hidden="true" tabindex="-1"></a>diff_results <span class="ot">&lt;-</span> <span class="fu">diff</span>(results)</span>
<span id="cb38-428"><a href="#cb38-428" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diff_results)</span>
<span id="cb38-429"><a href="#cb38-429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-430"><a href="#cb38-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-431"><a href="#cb38-431" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-432"><a href="#cb38-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-433"><a href="#cb38-433" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced ML Algorithms</span></span>
<span id="cb38-434"><a href="#cb38-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-435"><a href="#cb38-435" aria-hidden="true" tabindex="-1"></a><span class="fu">### XGBoost</span></span>
<span id="cb38-436"><a href="#cb38-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-437"><a href="#cb38-437" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-438"><a href="#cb38-438" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb38-439"><a href="#cb38-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-440"><a href="#cb38-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb38-441"><a href="#cb38-441" aria-hidden="true" tabindex="-1"></a>train_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-442"><a href="#cb38-442" aria-hidden="true" tabindex="-1"></a>train_label <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(train_data<span class="sc">$</span>Species) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb38-443"><a href="#cb38-443" aria-hidden="true" tabindex="-1"></a>test_matrix <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-444"><a href="#cb38-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-445"><a href="#cb38-445" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DMatrix</span></span>
<span id="cb38-446"><a href="#cb38-446" aria-hidden="true" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_matrix, <span class="at">label =</span> train_label)</span>
<span id="cb38-447"><a href="#cb38-447" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_matrix)</span>
<span id="cb38-448"><a href="#cb38-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-449"><a href="#cb38-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters</span></span>
<span id="cb38-450"><a href="#cb38-450" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-451"><a href="#cb38-451" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"multi:softmax"</span>,</span>
<span id="cb38-452"><a href="#cb38-452" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_class =</span> <span class="dv">3</span>,</span>
<span id="cb38-453"><a href="#cb38-453" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb38-454"><a href="#cb38-454" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.3</span>,</span>
<span id="cb38-455"><a href="#cb38-455" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,</span>
<span id="cb38-456"><a href="#cb38-456" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span></span>
<span id="cb38-457"><a href="#cb38-457" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-458"><a href="#cb38-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-459"><a href="#cb38-459" aria-hidden="true" tabindex="-1"></a><span class="co"># Train model</span></span>
<span id="cb38-460"><a href="#cb38-460" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb38-461"><a href="#cb38-461" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb38-462"><a href="#cb38-462" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb38-463"><a href="#cb38-463" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb38-464"><a href="#cb38-464" aria-hidden="true" tabindex="-1"></a>  <span class="at">watchlist =</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain),</span>
<span id="cb38-465"><a href="#cb38-465" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb38-466"><a href="#cb38-466" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb38-467"><a href="#cb38-467" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-468"><a href="#cb38-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-469"><a href="#cb38-469" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb38-470"><a href="#cb38-470" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, dtest)</span>
<span id="cb38-471"><a href="#cb38-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-472"><a href="#cb38-472" aria-hidden="true" tabindex="-1"></a><span class="co"># Feature importance</span></span>
<span id="cb38-473"><a href="#cb38-473" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">xgb.importance</span>(<span class="at">model =</span> xgb_model)</span>
<span id="cb38-474"><a href="#cb38-474" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(importance, <span class="at">top_n =</span> <span class="dv">10</span>)</span>
<span id="cb38-475"><a href="#cb38-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-476"><a href="#cb38-476" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-477"><a href="#cb38-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-478"><a href="#cb38-478" aria-hidden="true" tabindex="-1"></a>XGBoost fits an additive ensemble of decision trees:</span>
<span id="cb38-479"><a href="#cb38-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-480"><a href="#cb38-480" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-481"><a href="#cb38-481" aria-hidden="true" tabindex="-1"></a>\hat y_i = \sum_{k=1}^K f_k(x_i), \quad f_k \in \mathcal{F},</span>
<span id="cb38-482"><a href="#cb38-482" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-483"><a href="#cb38-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-484"><a href="#cb38-484" aria-hidden="true" tabindex="-1"></a>where each $f_k$ is a regression tree that assigns a constant score to each leaf region.</span>
<span id="cb38-485"><a href="#cb38-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-486"><a href="#cb38-486" aria-hidden="true" tabindex="-1"></a>For a loss function $l(y_i, \hat y_i)$, it minimizes the **regularized objective**</span>
<span id="cb38-487"><a href="#cb38-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-488"><a href="#cb38-488" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-489"><a href="#cb38-489" aria-hidden="true" tabindex="-1"></a>\mathcal{L} = \sum_{i=1}^n l\big(y_i, \hat y_i\big)</span>
<span id="cb38-490"><a href="#cb38-490" aria-hidden="true" tabindex="-1"></a><span class="ss">            + </span>\sum_{k=1}^K \Omega(f_k),</span>
<span id="cb38-491"><a href="#cb38-491" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-492"><a href="#cb38-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-493"><a href="#cb38-493" aria-hidden="true" tabindex="-1"></a>with tree complexity penalty</span>
<span id="cb38-494"><a href="#cb38-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-495"><a href="#cb38-495" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-496"><a href="#cb38-496" aria-hidden="true" tabindex="-1"></a>\Omega(f) = \gamma T + \tfrac{1}{2} \lambda \lVert w \rVert^2,</span>
<span id="cb38-497"><a href="#cb38-497" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-498"><a href="#cb38-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-499"><a href="#cb38-499" aria-hidden="true" tabindex="-1"></a>where $T$ is the number of leaves and $w$ are the leaf scores. At each boosting iteration, XGBoost uses a second-order Taylor expansion of the loss around the current predictions to compute optimal leaf weights and select splits, giving a fast approximation to gradient-boosted trees with built-in regularization.</span>
<span id="cb38-500"><a href="#cb38-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-501"><a href="#cb38-501" aria-hidden="true" tabindex="-1"></a>Hyperparameters such as <span class="in">`max_depth`</span>, <span class="in">`eta`</span> (learning rate), <span class="in">`subsample`</span>, and <span class="in">`colsample_bytree`</span> control how complex each tree can be and how strongly the ensemble is regularized.</span>
<span id="cb38-502"><a href="#cb38-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-503"><a href="#cb38-503" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random Forest (ranger)</span></span>
<span id="cb38-504"><a href="#cb38-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-505"><a href="#cb38-505" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-506"><a href="#cb38-506" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb38-507"><a href="#cb38-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-508"><a href="#cb38-508" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast random forest</span></span>
<span id="cb38-509"><a href="#cb38-509" aria-hidden="true" tabindex="-1"></a>rf_fast <span class="ot">&lt;-</span> <span class="fu">ranger</span>(</span>
<span id="cb38-510"><a href="#cb38-510" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-511"><a href="#cb38-511" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-512"><a href="#cb38-512" aria-hidden="true" tabindex="-1"></a>  <span class="at">num.trees =</span> <span class="dv">500</span>,</span>
<span id="cb38-513"><a href="#cb38-513" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="st">"impurity"</span>,</span>
<span id="cb38-514"><a href="#cb38-514" aria-hidden="true" tabindex="-1"></a>  <span class="at">probability =</span> <span class="cn">TRUE</span></span>
<span id="cb38-515"><a href="#cb38-515" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-516"><a href="#cb38-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-517"><a href="#cb38-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb38-518"><a href="#cb38-518" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_fast, test_data)<span class="sc">$</span>predictions</span>
<span id="cb38-519"><a href="#cb38-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-520"><a href="#cb38-520" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb38-521"><a href="#cb38-521" aria-hidden="true" tabindex="-1"></a><span class="fu">importance</span>(rf_fast)</span>
<span id="cb38-522"><a href="#cb38-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-523"><a href="#cb38-523" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-524"><a href="#cb38-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-525"><a href="#cb38-525" aria-hidden="true" tabindex="-1"></a>The <span class="in">`ranger`</span> model is a fast implementation of the same random forest idea used earlier: many decision trees are grown on bootstrap samples of the data, and predictions are aggregated.</span>
<span id="cb38-526"><a href="#cb38-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-527"><a href="#cb38-527" aria-hidden="true" tabindex="-1"></a>If $T_b(x)$ denotes the prediction of tree $b$, then for classification the forest prediction is typically</span>
<span id="cb38-528"><a href="#cb38-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-529"><a href="#cb38-529" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-530"><a href="#cb38-530" aria-hidden="true" tabindex="-1"></a>\hat y = \text{mode}<span class="sc">\{</span>T_1(x), T_2(x), \dots, T_B(x)<span class="sc">\}</span>,</span>
<span id="cb38-531"><a href="#cb38-531" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-532"><a href="#cb38-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-533"><a href="#cb38-533" aria-hidden="true" tabindex="-1"></a>and for regression it is the average. Each tree is built by recursively selecting splits that maximize the reduction in node impurity (e.g. Gini index for classification) while only considering a random subset of predictors at each node.</span>
<span id="cb38-534"><a href="#cb38-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-535"><a href="#cb38-535" aria-hidden="true" tabindex="-1"></a>This combination of **bagging** (bootstrap aggregation) and **random feature selection** reduces variance and decorrelates individual trees, leading to strong predictive performance without overfitting as badly as a single deep tree. The importance scores from <span class="in">`importance(rf_fast)`</span> summarize how much each variable contributes to reducing impurity across the forest.</span>
<span id="cb38-536"><a href="#cb38-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-537"><a href="#cb38-537" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deep Learning with keras</span></span>
<span id="cb38-538"><a href="#cb38-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-539"><a href="#cb38-539" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-540"><a href="#cb38-540" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb38-541"><a href="#cb38-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-542"><a href="#cb38-542" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb38-543"><a href="#cb38-543" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(train_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-544"><a href="#cb38-544" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">to_categorical</span>(<span class="fu">as.numeric</span>(train_data<span class="sc">$</span>Species) <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb38-545"><a href="#cb38-545" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-546"><a href="#cb38-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-547"><a href="#cb38-547" aria-hidden="true" tabindex="-1"></a><span class="co"># Build model</span></span>
<span id="cb38-548"><a href="#cb38-548" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-549"><a href="#cb38-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">64</span>, <span class="at">activation =</span> <span class="st">"relu"</span>, <span class="at">input_shape =</span> <span class="fu">ncol</span>(x_train)) <span class="sc">%&gt;%</span></span>
<span id="cb38-550"><a href="#cb38-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-551"><a href="#cb38-551" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">32</span>, <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-552"><a href="#cb38-552" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-553"><a href="#cb38-553" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">3</span>, <span class="at">activation =</span> <span class="st">"softmax"</span>)</span>
<span id="cb38-554"><a href="#cb38-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-555"><a href="#cb38-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile</span></span>
<span id="cb38-556"><a href="#cb38-556" aria-hidden="true" tabindex="-1"></a>model <span class="sc">%&gt;%</span> <span class="fu">compile</span>(</span>
<span id="cb38-557"><a href="#cb38-557" aria-hidden="true" tabindex="-1"></a>  <span class="at">loss =</span> <span class="st">"categorical_crossentropy"</span>,</span>
<span id="cb38-558"><a href="#cb38-558" aria-hidden="true" tabindex="-1"></a>  <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(<span class="at">lr =</span> <span class="fl">0.001</span>),</span>
<span id="cb38-559"><a href="#cb38-559" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"accuracy"</span>)</span>
<span id="cb38-560"><a href="#cb38-560" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-561"><a href="#cb38-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-562"><a href="#cb38-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Train</span></span>
<span id="cb38-563"><a href="#cb38-563" aria-hidden="true" tabindex="-1"></a>history <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb38-564"><a href="#cb38-564" aria-hidden="true" tabindex="-1"></a>  x_train, y_train,</span>
<span id="cb38-565"><a href="#cb38-565" aria-hidden="true" tabindex="-1"></a>  <span class="at">epochs =</span> <span class="dv">100</span>,</span>
<span id="cb38-566"><a href="#cb38-566" aria-hidden="true" tabindex="-1"></a>  <span class="at">batch_size =</span> <span class="dv">16</span>,</span>
<span id="cb38-567"><a href="#cb38-567" aria-hidden="true" tabindex="-1"></a>  <span class="at">validation_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb38-568"><a href="#cb38-568" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb38-569"><a href="#cb38-569" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-570"><a href="#cb38-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-571"><a href="#cb38-571" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot training history</span></span>
<span id="cb38-572"><a href="#cb38-572" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(history)</span>
<span id="cb38-573"><a href="#cb38-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-574"><a href="#cb38-574" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb38-575"><a href="#cb38-575" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(x_test)</span>
<span id="cb38-576"><a href="#cb38-576" aria-hidden="true" tabindex="-1"></a>predicted_class <span class="ot">&lt;-</span> <span class="fu">max.col</span>(predictions) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb38-577"><a href="#cb38-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-578"><a href="#cb38-578" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-579"><a href="#cb38-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-580"><a href="#cb38-580" aria-hidden="true" tabindex="-1"></a>The <span class="in">`keras`</span> example builds a fully connected **neural network** with two hidden layers. For an input vector $x$, weights $W^{(1)}, W^{(2)}, W^{(3)}$ and biases $b^{(1)}, b^{(2)}, b^{(3)}$, the forward pass is</span>
<span id="cb38-581"><a href="#cb38-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-582"><a href="#cb38-582" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-583"><a href="#cb38-583" aria-hidden="true" tabindex="-1"></a>h^{(1)} = \text{ReLU}(W^{(1)} x + b^{(1)}),<span class="sc">\\</span></span>
<span id="cb38-584"><a href="#cb38-584" aria-hidden="true" tabindex="-1"></a>h^{(2)} = \text{ReLU}(W^{(2)} h^{(1)} + b^{(2)}),<span class="sc">\\</span></span>
<span id="cb38-585"><a href="#cb38-585" aria-hidden="true" tabindex="-1"></a>z = W^{(3)} h^{(2)} + b^{(3)},<span class="sc">\\</span></span>
<span id="cb38-586"><a href="#cb38-586" aria-hidden="true" tabindex="-1"></a>\hat y = \text{softmax}(z),</span>
<span id="cb38-587"><a href="#cb38-587" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-588"><a href="#cb38-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-589"><a href="#cb38-589" aria-hidden="true" tabindex="-1"></a>where ReLU is the rectified linear unit activation and softmax converts logits $z$ into class probabilities.</span>
<span id="cb38-590"><a href="#cb38-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-591"><a href="#cb38-591" aria-hidden="true" tabindex="-1"></a>For multi-class classification with one-hot targets $y_i$, the loss is **categorical cross-entropy**</span>
<span id="cb38-592"><a href="#cb38-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-593"><a href="#cb38-593" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-594"><a href="#cb38-594" aria-hidden="true" tabindex="-1"></a>\mathcal{L} = - \sum_{i=1}^n \sum_{k=1}^K y_{ik} \log \hat y_{ik},</span>
<span id="cb38-595"><a href="#cb38-595" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-596"><a href="#cb38-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-597"><a href="#cb38-597" aria-hidden="true" tabindex="-1"></a>which is minimized using stochastic gradient descent (or a variant like Adam, as used here). Gradients of the loss with respect to all weights and biases are computed efficiently by **backpropagation**.</span>
<span id="cb38-598"><a href="#cb38-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-599"><a href="#cb38-599" aria-hidden="true" tabindex="-1"></a>The dropout layers randomly zero out a fraction of hidden units during training, which acts as a regularizer by preventing co-adaptation of features and approximating an ensemble of many thinned networks.</span>
<span id="cb38-600"><a href="#cb38-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-601"><a href="#cb38-601" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-602"><a href="#cb38-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-603"><a href="#cb38-603" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Evaluation and Tuning</span></span>
<span id="cb38-604"><a href="#cb38-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-605"><a href="#cb38-605" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hyperparameter Tuning</span></span>
<span id="cb38-606"><a href="#cb38-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-607"><a href="#cb38-607" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-608"><a href="#cb38-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Grid search</span></span>
<span id="cb38-609"><a href="#cb38-609" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb38-610"><a href="#cb38-610" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb38-611"><a href="#cb38-611" aria-hidden="true" tabindex="-1"></a>  <span class="at">splitrule =</span> <span class="fu">c</span>(<span class="st">"gini"</span>, <span class="st">"extratrees"</span>),</span>
<span id="cb38-612"><a href="#cb38-612" aria-hidden="true" tabindex="-1"></a>  <span class="at">min.node.size =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb38-613"><a href="#cb38-613" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-614"><a href="#cb38-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-615"><a href="#cb38-615" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-616"><a href="#cb38-616" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-617"><a href="#cb38-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-618"><a href="#cb38-618" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ranger"</span>,</span>
<span id="cb38-619"><a href="#cb38-619" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-620"><a href="#cb38-620" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneGrid =</span> grid</span>
<span id="cb38-621"><a href="#cb38-621" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-622"><a href="#cb38-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-623"><a href="#cb38-623" aria-hidden="true" tabindex="-1"></a><span class="co"># Random search</span></span>
<span id="cb38-624"><a href="#cb38-624" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-625"><a href="#cb38-625" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-626"><a href="#cb38-626" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-627"><a href="#cb38-627" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ranger"</span>,</span>
<span id="cb38-628"><a href="#cb38-628" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-629"><a href="#cb38-629" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength =</span> <span class="dv">20</span>,</span>
<span id="cb38-630"><a href="#cb38-630" aria-hidden="true" tabindex="-1"></a>  <span class="at">search =</span> <span class="st">"random"</span></span>
<span id="cb38-631"><a href="#cb38-631" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-632"><a href="#cb38-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-633"><a href="#cb38-633" aria-hidden="true" tabindex="-1"></a><span class="co"># Best parameters</span></span>
<span id="cb38-634"><a href="#cb38-634" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>bestTune</span>
<span id="cb38-635"><a href="#cb38-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-636"><a href="#cb38-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-637"><a href="#cb38-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross-Validation Strategies</span></span>
<span id="cb38-638"><a href="#cb38-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-639"><a href="#cb38-639" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-640"><a href="#cb38-640" aria-hidden="true" tabindex="-1"></a><span class="co"># K-fold CV</span></span>
<span id="cb38-641"><a href="#cb38-641" aria-hidden="true" tabindex="-1"></a>cv_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb38-642"><a href="#cb38-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-643"><a href="#cb38-643" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeated K-fold</span></span>
<span id="cb38-644"><a href="#cb38-644" aria-hidden="true" tabindex="-1"></a>cv_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb38-645"><a href="#cb38-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-646"><a href="#cb38-646" aria-hidden="true" tabindex="-1"></a><span class="co"># Leave-one-out CV</span></span>
<span id="cb38-647"><a href="#cb38-647" aria-hidden="true" tabindex="-1"></a>loo_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"LOOCV"</span>)</span>
<span id="cb38-648"><a href="#cb38-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-649"><a href="#cb38-649" aria-hidden="true" tabindex="-1"></a><span class="co"># Time series CV</span></span>
<span id="cb38-650"><a href="#cb38-650" aria-hidden="true" tabindex="-1"></a>ts_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"timeslice"</span>,</span>
<span id="cb38-651"><a href="#cb38-651" aria-hidden="true" tabindex="-1"></a>                           <span class="at">initialWindow =</span> <span class="dv">100</span>,</span>
<span id="cb38-652"><a href="#cb38-652" aria-hidden="true" tabindex="-1"></a>                           <span class="at">horizon =</span> <span class="dv">10</span>,</span>
<span id="cb38-653"><a href="#cb38-653" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixedWindow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-654"><a href="#cb38-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-655"><a href="#cb38-655" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom CV</span></span>
<span id="cb38-656"><a href="#cb38-656" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">createFolds</span>(train_data<span class="sc">$</span>Species, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb38-657"><a href="#cb38-657" aria-hidden="true" tabindex="-1"></a>custom_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">index =</span> folds)</span>
<span id="cb38-658"><a href="#cb38-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-659"><a href="#cb38-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-660"><a href="#cb38-660" aria-hidden="true" tabindex="-1"></a><span class="fu">### Feature Selection</span></span>
<span id="cb38-661"><a href="#cb38-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-662"><a href="#cb38-662" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-663"><a href="#cb38-663" aria-hidden="true" tabindex="-1"></a><span class="co"># Recursive feature elimination</span></span>
<span id="cb38-664"><a href="#cb38-664" aria-hidden="true" tabindex="-1"></a>control <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> rfFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb38-665"><a href="#cb38-665" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">rfe</span>(</span>
<span id="cb38-666"><a href="#cb38-666" aria-hidden="true" tabindex="-1"></a>  train_data[, <span class="sc">-</span><span class="dv">5</span>],</span>
<span id="cb38-667"><a href="#cb38-667" aria-hidden="true" tabindex="-1"></a>  train_data<span class="sc">$</span>Species,</span>
<span id="cb38-668"><a href="#cb38-668" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb38-669"><a href="#cb38-669" aria-hidden="true" tabindex="-1"></a>  <span class="at">rfeControl =</span> control</span>
<span id="cb38-670"><a href="#cb38-670" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-671"><a href="#cb38-671" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results)</span>
<span id="cb38-672"><a href="#cb38-672" aria-hidden="true" tabindex="-1"></a><span class="fu">predictors</span>(results)</span>
<span id="cb38-673"><a href="#cb38-673" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(results, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"g"</span>, <span class="st">"o"</span>))</span>
<span id="cb38-674"><a href="#cb38-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-675"><a href="#cb38-675" aria-hidden="true" tabindex="-1"></a><span class="co"># Boruta (all-relevant feature selection)</span></span>
<span id="cb38-676"><a href="#cb38-676" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Boruta)</span>
<span id="cb38-677"><a href="#cb38-677" aria-hidden="true" tabindex="-1"></a>boruta_result <span class="ot">&lt;-</span> <span class="fu">Boruta</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">doTrace =</span> <span class="dv">2</span>)</span>
<span id="cb38-678"><a href="#cb38-678" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(boruta_result)</span>
<span id="cb38-679"><a href="#cb38-679" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(boruta_result)</span>
<span id="cb38-680"><a href="#cb38-680" aria-hidden="true" tabindex="-1"></a><span class="fu">getSelectedAttributes</span>(boruta_result, <span class="at">withTentative =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-681"><a href="#cb38-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-682"><a href="#cb38-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-683"><a href="#cb38-683" aria-hidden="true" tabindex="-1"></a><span class="fu">### Ensemble Methods</span></span>
<span id="cb38-684"><a href="#cb38-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-685"><a href="#cb38-685" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-686"><a href="#cb38-686" aria-hidden="true" tabindex="-1"></a><span class="co"># Stacking</span></span>
<span id="cb38-687"><a href="#cb38-687" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caretEnsemble)</span>
<span id="cb38-688"><a href="#cb38-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-689"><a href="#cb38-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Train multiple models</span></span>
<span id="cb38-690"><a href="#cb38-690" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">caretList</span>(</span>
<span id="cb38-691"><a href="#cb38-691" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-692"><a href="#cb38-692" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb38-693"><a href="#cb38-693" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> train_control,</span>
<span id="cb38-694"><a href="#cb38-694" aria-hidden="true" tabindex="-1"></a>  <span class="at">methodList =</span> <span class="fu">c</span>(<span class="st">"rf"</span>, <span class="st">"glm"</span>, <span class="st">"knn"</span>)</span>
<span id="cb38-695"><a href="#cb38-695" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-696"><a href="#cb38-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-697"><a href="#cb38-697" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack models</span></span>
<span id="cb38-698"><a href="#cb38-698" aria-hidden="true" tabindex="-1"></a>stack_model <span class="ot">&lt;-</span> <span class="fu">caretStack</span>(</span>
<span id="cb38-699"><a href="#cb38-699" aria-hidden="true" tabindex="-1"></a>  model_list,</span>
<span id="cb38-700"><a href="#cb38-700" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb38-701"><a href="#cb38-701" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb38-702"><a href="#cb38-702" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(</span>
<span id="cb38-703"><a href="#cb38-703" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb38-704"><a href="#cb38-704" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">10</span>,</span>
<span id="cb38-705"><a href="#cb38-705" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions =</span> <span class="st">"final"</span>,</span>
<span id="cb38-706"><a href="#cb38-706" aria-hidden="true" tabindex="-1"></a>    <span class="at">classProbs =</span> <span class="cn">TRUE</span></span>
<span id="cb38-707"><a href="#cb38-707" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-708"><a href="#cb38-708" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-709"><a href="#cb38-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-710"><a href="#cb38-710" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb38-711"><a href="#cb38-711" aria-hidden="true" tabindex="-1"></a>stack_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(stack_model, test_data)</span>
<span id="cb38-712"><a href="#cb38-712" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-713"><a href="#cb38-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-714"><a href="#cb38-714" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-715"><a href="#cb38-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-716"><a href="#cb38-716" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time Series Analysis</span></span>
<span id="cb38-717"><a href="#cb38-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-718"><a href="#cb38-718" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Time Series</span></span>
<span id="cb38-719"><a href="#cb38-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-720"><a href="#cb38-720" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-721"><a href="#cb38-721" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series</span></span>
<span id="cb38-722"><a href="#cb38-722" aria-hidden="true" tabindex="-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(AirPassengers, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb38-723"><a href="#cb38-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-724"><a href="#cb38-724" aria-hidden="true" tabindex="-1"></a><span class="co"># Decomposition</span></span>
<span id="cb38-725"><a href="#cb38-725" aria-hidden="true" tabindex="-1"></a>decomp <span class="ot">&lt;-</span> <span class="fu">decompose</span>(ts_data)</span>
<span id="cb38-726"><a href="#cb38-726" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(decomp)</span>
<span id="cb38-727"><a href="#cb38-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-728"><a href="#cb38-728" aria-hidden="true" tabindex="-1"></a><span class="co"># STL decomposition</span></span>
<span id="cb38-729"><a href="#cb38-729" aria-hidden="true" tabindex="-1"></a>stl_result <span class="ot">&lt;-</span> <span class="fu">stl</span>(ts_data, <span class="at">s.window =</span> <span class="st">"periodic"</span>)</span>
<span id="cb38-730"><a href="#cb38-730" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stl_result)</span>
<span id="cb38-731"><a href="#cb38-731" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-732"><a href="#cb38-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-733"><a href="#cb38-733" aria-hidden="true" tabindex="-1"></a><span class="fu">### ARIMA Models</span></span>
<span id="cb38-734"><a href="#cb38-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-735"><a href="#cb38-735" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-736"><a href="#cb38-736" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb38-737"><a href="#cb38-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-738"><a href="#cb38-738" aria-hidden="true" tabindex="-1"></a><span class="co"># Automatic ARIMA</span></span>
<span id="cb38-739"><a href="#cb38-739" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_data)</span>
<span id="cb38-740"><a href="#cb38-740" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit)</span>
<span id="cb38-741"><a href="#cb38-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-742"><a href="#cb38-742" aria-hidden="true" tabindex="-1"></a><span class="co"># Check residuals</span></span>
<span id="cb38-743"><a href="#cb38-743" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit)</span>
<span id="cb38-744"><a href="#cb38-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-745"><a href="#cb38-745" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb38-746"><a href="#cb38-746" aria-hidden="true" tabindex="-1"></a>forecast_result <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit, <span class="at">h =</span> <span class="dv">24</span>)</span>
<span id="cb38-747"><a href="#cb38-747" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_result)</span>
<span id="cb38-748"><a href="#cb38-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-749"><a href="#cb38-749" aria-hidden="true" tabindex="-1"></a><span class="co"># Manual ARIMA</span></span>
<span id="cb38-750"><a href="#cb38-750" aria-hidden="true" tabindex="-1"></a>fit_manual <span class="ot">&lt;-</span> <span class="fu">arima</span>(ts_data, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">seasonal =</span> <span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)))</span>
<span id="cb38-751"><a href="#cb38-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-752"><a href="#cb38-752" aria-hidden="true" tabindex="-1"></a><span class="co"># Model diagnostics</span></span>
<span id="cb38-753"><a href="#cb38-753" aria-hidden="true" tabindex="-1"></a><span class="fu">tsdiag</span>(fit_manual)</span>
<span id="cb38-754"><a href="#cb38-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-755"><a href="#cb38-755" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-756"><a href="#cb38-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-757"><a href="#cb38-757" aria-hidden="true" tabindex="-1"></a>An $\text{ARIMA}(p,d,q)$ model combines **autoregressive (AR)**, **integration (I)**, and **moving-average (MA)** components. Applied to the differenced series</span>
<span id="cb38-758"><a href="#cb38-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-759"><a href="#cb38-759" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-760"><a href="#cb38-760" aria-hidden="true" tabindex="-1"></a>w_t = (1 - B)^d y_t,</span>
<span id="cb38-761"><a href="#cb38-761" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-762"><a href="#cb38-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-763"><a href="#cb38-763" aria-hidden="true" tabindex="-1"></a>where $B$ is the backshift operator ($B y_t = y_{t-1}$), the general form is</span>
<span id="cb38-764"><a href="#cb38-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-765"><a href="#cb38-765" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-766"><a href="#cb38-766" aria-hidden="true" tabindex="-1"></a>\phi(B) w_t = \theta(B) \varepsilon_t,</span>
<span id="cb38-767"><a href="#cb38-767" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-768"><a href="#cb38-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-769"><a href="#cb38-769" aria-hidden="true" tabindex="-1"></a>with AR and MA polynomials</span>
<span id="cb38-770"><a href="#cb38-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-771"><a href="#cb38-771" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-772"><a href="#cb38-772" aria-hidden="true" tabindex="-1"></a>\phi(B) = 1 - \phi_1 B - \cdots - \phi_p B^p, \qquad</span>
<span id="cb38-773"><a href="#cb38-773" aria-hidden="true" tabindex="-1"></a>\theta(B) = 1 + \theta_1 B + \cdots + \theta_q B^q,</span>
<span id="cb38-774"><a href="#cb38-774" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-775"><a href="#cb38-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-776"><a href="#cb38-776" aria-hidden="true" tabindex="-1"></a>and innovations $\varepsilon_t \sim \mathcal{N}(0, \sigma^2)$.</span>
<span id="cb38-777"><a href="#cb38-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-778"><a href="#cb38-778" aria-hidden="true" tabindex="-1"></a>The parameters $(\phi_i, \theta_j, d)$ are typically estimated by **maximum likelihood**, which numerically maximizes the probability of the observed time series under the model. <span class="in">`auto.arima()`</span> searches over candidate $(p,d,q)$ values using criteria such as AICc, while <span class="in">`checkresiduals()`</span> and <span class="in">`tsdiag()`</span> help verify that the residuals behave like white noise (no remaining structure).</span>
<span id="cb38-779"><a href="#cb38-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-780"><a href="#cb38-780" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exponential Smoothing</span></span>
<span id="cb38-781"><a href="#cb38-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-782"><a href="#cb38-782" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-783"><a href="#cb38-783" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple exponential smoothing</span></span>
<span id="cb38-784"><a href="#cb38-784" aria-hidden="true" tabindex="-1"></a>fit_ses <span class="ot">&lt;-</span> <span class="fu">ses</span>(ts_data, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb38-785"><a href="#cb38-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-786"><a href="#cb38-786" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt's method (trend)</span></span>
<span id="cb38-787"><a href="#cb38-787" aria-hidden="true" tabindex="-1"></a>fit_holt <span class="ot">&lt;-</span> <span class="fu">holt</span>(ts_data, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb38-788"><a href="#cb38-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-789"><a href="#cb38-789" aria-hidden="true" tabindex="-1"></a><span class="co"># Holt-Winters (trend + seasonality)</span></span>
<span id="cb38-790"><a href="#cb38-790" aria-hidden="true" tabindex="-1"></a>fit_hw <span class="ot">&lt;-</span> <span class="fu">hw</span>(ts_data, <span class="at">seasonal =</span> <span class="st">"multiplicative"</span>, <span class="at">h =</span> <span class="dv">24</span>)</span>
<span id="cb38-791"><a href="#cb38-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-792"><a href="#cb38-792" aria-hidden="true" tabindex="-1"></a><span class="co"># ETS (Error, Trend, Seasonal)</span></span>
<span id="cb38-793"><a href="#cb38-793" aria-hidden="true" tabindex="-1"></a>fit_ets <span class="ot">&lt;-</span> <span class="fu">ets</span>(ts_data)</span>
<span id="cb38-794"><a href="#cb38-794" aria-hidden="true" tabindex="-1"></a>forecast_ets <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fit_ets, <span class="at">h =</span> <span class="dv">24</span>)</span>
<span id="cb38-795"><a href="#cb38-795" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_ets)</span>
<span id="cb38-796"><a href="#cb38-796" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-797"><a href="#cb38-797" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-798"><a href="#cb38-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-799"><a href="#cb38-799" aria-hidden="true" tabindex="-1"></a>Exponential smoothing methods describe a time series in terms of recursively updated components for **level**, **trend**, and (optionally) **seasonality**.</span>
<span id="cb38-800"><a href="#cb38-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-801"><a href="#cb38-801" aria-hidden="true" tabindex="-1"></a>For example, **simple exponential smoothing** (no trend or seasonality) uses</span>
<span id="cb38-802"><a href="#cb38-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-803"><a href="#cb38-803" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-804"><a href="#cb38-804" aria-hidden="true" tabindex="-1"></a>\ell_t = \alpha y_t + (1-\alpha)\, \ell_{t-1}, \quad</span>
<span id="cb38-805"><a href="#cb38-805" aria-hidden="true" tabindex="-1"></a>\hat y_{t+1} = \ell_t,</span>
<span id="cb38-806"><a href="#cb38-806" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-807"><a href="#cb38-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-808"><a href="#cb38-808" aria-hidden="true" tabindex="-1"></a>where $\alpha \in (0,1)$ is the smoothing parameter and $\ell_t$ is the smoothed level.</span>
<span id="cb38-809"><a href="#cb38-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-810"><a href="#cb38-810" aria-hidden="true" tabindex="-1"></a>Holt’s method adds a trend component $b_t$ and Holt–Winters adds seasonal components (additive or multiplicative). The <span class="in">`ets()`</span> function chooses among a family of **Error–Trend–Seasonal (ETS)** state-space models and estimates the smoothing parameters by maximizing the likelihood of one-step-ahead forecast errors.</span>
<span id="cb38-811"><a href="#cb38-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-812"><a href="#cb38-812" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prophet (Facebook)</span></span>
<span id="cb38-813"><a href="#cb38-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-814"><a href="#cb38-814" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-815"><a href="#cb38-815" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prophet)</span>
<span id="cb38-816"><a href="#cb38-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-817"><a href="#cb38-817" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb38-818"><a href="#cb38-818" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-819"><a href="#cb38-819" aria-hidden="true" tabindex="-1"></a>  <span class="at">ds =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="st">"2020-01-01"</span>), <span class="at">by =</span> <span class="st">"day"</span>, <span class="at">length.out =</span> <span class="dv">365</span>),</span>
<span id="cb38-820"><a href="#cb38-820" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">365</span>, <span class="at">mean =</span> <span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb38-821"><a href="#cb38-821" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-822"><a href="#cb38-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-823"><a href="#cb38-823" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb38-824"><a href="#cb38-824" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">prophet</span>(df)</span>
<span id="cb38-825"><a href="#cb38-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-826"><a href="#cb38-826" aria-hidden="true" tabindex="-1"></a><span class="co"># Make future dataframe</span></span>
<span id="cb38-827"><a href="#cb38-827" aria-hidden="true" tabindex="-1"></a>future <span class="ot">&lt;-</span> <span class="fu">make_future_dataframe</span>(m, <span class="at">periods =</span> <span class="dv">90</span>)</span>
<span id="cb38-828"><a href="#cb38-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-829"><a href="#cb38-829" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecast</span></span>
<span id="cb38-830"><a href="#cb38-830" aria-hidden="true" tabindex="-1"></a>forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, future)</span>
<span id="cb38-831"><a href="#cb38-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-832"><a href="#cb38-832" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb38-833"><a href="#cb38-833" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m, forecast)</span>
<span id="cb38-834"><a href="#cb38-834" aria-hidden="true" tabindex="-1"></a><span class="fu">prophet_plot_components</span>(m, forecast)</span>
<span id="cb38-835"><a href="#cb38-835" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-836"><a href="#cb38-836" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Math and Explanation</span></span>
<span id="cb38-837"><a href="#cb38-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-838"><a href="#cb38-838" aria-hidden="true" tabindex="-1"></a>Prophet models a time series as a sum of interpretable components</span>
<span id="cb38-839"><a href="#cb38-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-840"><a href="#cb38-840" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-841"><a href="#cb38-841" aria-hidden="true" tabindex="-1"></a>y(t) = g(t) + s(t) + h(t) + \varepsilon_t,</span>
<span id="cb38-842"><a href="#cb38-842" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb38-843"><a href="#cb38-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-844"><a href="#cb38-844" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb38-845"><a href="#cb38-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-846"><a href="#cb38-846" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$g(t)$ is a piecewise linear or logistic **trend** with changepoints,</span>
<span id="cb38-847"><a href="#cb38-847" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$s(t)$ is a **seasonal** component (e.g. yearly, weekly) represented by Fourier series,</span>
<span id="cb38-848"><a href="#cb38-848" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$h(t)$ captures **holiday or event** effects,</span>
<span id="cb38-849"><a href="#cb38-849" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\varepsilon_t$ is an error term.</span>
<span id="cb38-850"><a href="#cb38-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-851"><a href="#cb38-851" aria-hidden="true" tabindex="-1"></a>Prophet uses a Bayesian/state-space formulation with priors that encourage smooth trends and reasonable seasonal patterns. Fitting <span class="in">`m &lt;- prophet(df)`</span> estimates the parameters of these components (trend slopes, changepoints, seasonal amplitudes, holiday effects), and <span class="in">`prophet_plot_components()`</span> visualizes each component separately so you can interpret how trend, seasonality, and holidays contribute to the observed series.</span>
<span id="cb38-852"><a href="#cb38-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-853"><a href="#cb38-853" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-854"><a href="#cb38-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-855"><a href="#cb38-855" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Markdown and Reproducible Research</span></span>
<span id="cb38-856"><a href="#cb38-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-857"><a href="#cb38-857" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic R Markdown</span></span>
<span id="cb38-858"><a href="#cb38-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-859"><a href="#cb38-859" aria-hidden="true" tabindex="-1"></a><span class="in">```markdown</span></span>
<span id="cb38-860"><a href="#cb38-860" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-861"><a href="#cb38-861" aria-hidden="true" tabindex="-1"></a>title: "My Analysis"</span>
<span id="cb38-862"><a href="#cb38-862" aria-hidden="true" tabindex="-1"></a>author: "Your Name"</span>
<span id="cb38-863"><a href="#cb38-863" aria-hidden="true" tabindex="-1"></a>date: "<span class="in">`r Sys.Date()`</span>"</span>
<span id="cb38-864"><a href="#cb38-864" aria-hidden="true" tabindex="-1"></a>output: html_document</span>
<span id="cb38-865"><a href="#cb38-865" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-866"><a href="#cb38-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-867"><a href="#cb38-867" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb38-868"><a href="#cb38-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-869"><a href="#cb38-869" aria-hidden="true" tabindex="-1"></a>This is an R Markdown document.</span>
<span id="cb38-870"><a href="#cb38-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-871"><a href="#cb38-871" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-872"><a href="#cb38-872" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: setup, include=FALSE</span></span>
<span id="cb38-873"><a href="#cb38-873" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>, <span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-874"><a href="#cb38-874" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-875"><a href="#cb38-875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-876"><a href="#cb38-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-877"><a href="#cb38-877" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Analysis</span></span>
<span id="cb38-878"><a href="#cb38-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-879"><a href="#cb38-879" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-880"><a href="#cb38-880" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: load-data</span></span>
<span id="cb38-881"><a href="#cb38-881" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb38-882"><a href="#cb38-882" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mtcars)</span>
<span id="cb38-883"><a href="#cb38-883" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-884"><a href="#cb38-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-885"><a href="#cb38-885" aria-hidden="true" tabindex="-1"></a><span class="fu">## Visualization</span></span>
<span id="cb38-886"><a href="#cb38-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-887"><a href="#cb38-887" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-888"><a href="#cb38-888" aria-hidden="true" tabindex="-1"></a><span class="co"># chunk: plot, fig.width=8, fig.height=6</span></span>
<span id="cb38-889"><a href="#cb38-889" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb38-890"><a href="#cb38-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb38-891"><a href="#cb38-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb38-892"><a href="#cb38-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-893"><a href="#cb38-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-894"><a href="#cb38-894" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb38-895"><a href="#cb38-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-896"><a href="#cb38-896" aria-hidden="true" tabindex="-1"></a>Results show...</span>
<span id="cb38-897"><a href="#cb38-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-898"><a href="#cb38-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-899"><a href="#cb38-899" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced R Markdown Features</span></span>
<span id="cb38-900"><a href="#cb38-900" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-901"><a href="#cb38-901" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-902"><a href="#cb38-902" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameterized reports</span></span>
<span id="cb38-903"><a href="#cb38-903" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-904"><a href="#cb38-904" aria-hidden="true" tabindex="-1"></a>title<span class="sc">:</span> <span class="st">"Parameterized Report"</span></span>
<span id="cb38-905"><a href="#cb38-905" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> html_document</span>
<span id="cb38-906"><a href="#cb38-906" aria-hidden="true" tabindex="-1"></a>params<span class="sc">:</span></span>
<span id="cb38-907"><a href="#cb38-907" aria-hidden="true" tabindex="-1"></a>  year<span class="sc">:</span> <span class="dv">2023</span></span>
<span id="cb38-908"><a href="#cb38-908" aria-hidden="true" tabindex="-1"></a>  country<span class="sc">:</span> <span class="st">"USA"</span></span>
<span id="cb38-909"><a href="#cb38-909" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-910"><a href="#cb38-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-911"><a href="#cb38-911" aria-hidden="true" tabindex="-1"></a><span class="co"># Inline code</span></span>
<span id="cb38-912"><a href="#cb38-912" aria-hidden="true" tabindex="-1"></a>The analysis covers data from <span class="st">`</span><span class="at">r params$year</span><span class="st">`</span> <span class="cf">in</span> <span class="st">`</span><span class="at">r params$country</span><span class="st">`</span>.</span>
<span id="cb38-913"><a href="#cb38-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-914"><a href="#cb38-914" aria-hidden="true" tabindex="-1"></a><span class="co"># Caching</span></span>
<span id="cb38-915"><a href="#cb38-915" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">r</span></span>
<span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a><span class="at"># chunk: expensive-computation, cache=TRUE</span></span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a><span class="at">result &lt;- very_long_computation()</span></span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a><span class="co"># Child documents</span></span>
<span id="cb38-921"><a href="#cb38-921" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">r</span></span>
<span id="cb38-922"><a href="#cb38-922" aria-hidden="true" tabindex="-1"></a><span class="at"># chunk: child='analysis-section.Rmd'</span></span>
<span id="cb38-923"><a href="#cb38-923" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb38-924"><a href="#cb38-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-925"><a href="#cb38-925" aria-hidden="true" tabindex="-1"></a><span class="co"># Tables with kable</span></span>
<span id="cb38-926"><a href="#cb38-926" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">r</span></span>
<span id="cb38-927"><a href="#cb38-927" aria-hidden="true" tabindex="-1"></a><span class="at"># chunk: r (kable example)</span></span>
<span id="cb38-928"><a href="#cb38-928" aria-hidden="true" tabindex="-1"></a><span class="at">library(knitr)</span></span>
<span id="cb38-929"><a href="#cb38-929" aria-hidden="true" tabindex="-1"></a><span class="at">kable(head(mtcars), caption = "Motor Trend Cars")</span></span>
<span id="cb38-930"><a href="#cb38-930" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb38-931"><a href="#cb38-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-932"><a href="#cb38-932" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive tables</span></span>
<span id="cb38-933"><a href="#cb38-933" aria-hidden="true" tabindex="-1"></a><span class="st">```</span><span class="at">r</span></span>
<span id="cb38-934"><a href="#cb38-934" aria-hidden="true" tabindex="-1"></a><span class="at"># chunk: r (DT example)</span></span>
<span id="cb38-935"><a href="#cb38-935" aria-hidden="true" tabindex="-1"></a><span class="at">library(DT)</span></span>
<span id="cb38-936"><a href="#cb38-936" aria-hidden="true" tabindex="-1"></a><span class="at">datatable(mtcars, filter = 'top')</span></span>
<span id="cb38-937"><a href="#cb38-937" aria-hidden="true" tabindex="-1"></a><span class="st">```</span></span>
<span id="cb38-938"><a href="#cb38-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-939"><a href="#cb38-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-940"><a href="#cb38-940" aria-hidden="true" tabindex="-1"></a><span class="fu">### Output Formats</span></span>
<span id="cb38-941"><a href="#cb38-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-942"><a href="#cb38-942" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-943"><a href="#cb38-943" aria-hidden="true" tabindex="-1"></a><span class="co"># PDF output</span></span>
<span id="cb38-944"><a href="#cb38-944" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-945"><a href="#cb38-945" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> pdf_document</span>
<span id="cb38-946"><a href="#cb38-946" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-947"><a href="#cb38-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-948"><a href="#cb38-948" aria-hidden="true" tabindex="-1"></a><span class="co"># Word document</span></span>
<span id="cb38-949"><a href="#cb38-949" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-950"><a href="#cb38-950" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> word_document</span>
<span id="cb38-951"><a href="#cb38-951" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-952"><a href="#cb38-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-953"><a href="#cb38-953" aria-hidden="true" tabindex="-1"></a><span class="co"># Presentation (slides)</span></span>
<span id="cb38-954"><a href="#cb38-954" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-955"><a href="#cb38-955" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> </span>
<span id="cb38-956"><a href="#cb38-956" aria-hidden="true" tabindex="-1"></a>  ioslides_presentation<span class="sc">:</span></span>
<span id="cb38-957"><a href="#cb38-957" aria-hidden="true" tabindex="-1"></a>    widescreen<span class="sc">:</span> true</span>
<span id="cb38-958"><a href="#cb38-958" aria-hidden="true" tabindex="-1"></a>    smaller<span class="sc">:</span> true</span>
<span id="cb38-959"><a href="#cb38-959" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-960"><a href="#cb38-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-961"><a href="#cb38-961" aria-hidden="true" tabindex="-1"></a><span class="co"># Dashboard</span></span>
<span id="cb38-962"><a href="#cb38-962" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-963"><a href="#cb38-963" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> flexdashboard<span class="sc">::</span>flex_dashboard</span>
<span id="cb38-964"><a href="#cb38-964" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-965"><a href="#cb38-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-966"><a href="#cb38-966" aria-hidden="true" tabindex="-1"></a><span class="co"># Bookdown (books)</span></span>
<span id="cb38-967"><a href="#cb38-967" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-968"><a href="#cb38-968" aria-hidden="true" tabindex="-1"></a>output<span class="sc">:</span> bookdown<span class="sc">::</span>gitbook</span>
<span id="cb38-969"><a href="#cb38-969" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb38-970"><a href="#cb38-970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-971"><a href="#cb38-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-972"><a href="#cb38-972" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-973"><a href="#cb38-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-974"><a href="#cb38-974" aria-hidden="true" tabindex="-1"></a><span class="fu">## Performance Optimization</span></span>
<span id="cb38-975"><a href="#cb38-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-976"><a href="#cb38-976" aria-hidden="true" tabindex="-1"></a><span class="fu">### Profiling Code</span></span>
<span id="cb38-977"><a href="#cb38-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-978"><a href="#cb38-978" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-979"><a href="#cb38-979" aria-hidden="true" tabindex="-1"></a><span class="co"># Profile code execution</span></span>
<span id="cb38-980"><a href="#cb38-980" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(profvis)</span>
<span id="cb38-981"><a href="#cb38-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-982"><a href="#cb38-982" aria-hidden="true" tabindex="-1"></a><span class="fu">profvis</span>({</span>
<span id="cb38-983"><a href="#cb38-983" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>))</span>
<span id="cb38-984"><a href="#cb38-984" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb38-985"><a href="#cb38-985" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, data)</span>
<span id="cb38-986"><a href="#cb38-986" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-987"><a href="#cb38-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-988"><a href="#cb38-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Benchmark functions</span></span>
<span id="cb38-989"><a href="#cb38-989" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark)</span>
<span id="cb38-990"><a href="#cb38-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-991"><a href="#cb38-991" aria-hidden="true" tabindex="-1"></a><span class="fu">microbenchmark</span>(</span>
<span id="cb38-992"><a href="#cb38-992" aria-hidden="true" tabindex="-1"></a>  <span class="at">base =</span> <span class="fu">apply</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">ncol =</span> <span class="dv">100</span>), <span class="dv">1</span>, sum),</span>
<span id="cb38-993"><a href="#cb38-993" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowSums =</span> <span class="fu">rowSums</span>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">ncol =</span> <span class="dv">100</span>)),</span>
<span id="cb38-994"><a href="#cb38-994" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">100</span></span>
<span id="cb38-995"><a href="#cb38-995" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-996"><a href="#cb38-996" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-997"><a href="#cb38-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-998"><a href="#cb38-998" aria-hidden="true" tabindex="-1"></a><span class="fu">### Vectorization</span></span>
<span id="cb38-999"><a href="#cb38-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1000"><a href="#cb38-1000" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1001"><a href="#cb38-1001" aria-hidden="true" tabindex="-1"></a><span class="co"># Slow: loop</span></span>
<span id="cb38-1002"><a href="#cb38-1002" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">10000</span>)</span>
<span id="cb38-1003"><a href="#cb38-1003" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) {</span>
<span id="cb38-1004"><a href="#cb38-1004" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span> i<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb38-1005"><a href="#cb38-1005" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1006"><a href="#cb38-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1007"><a href="#cb38-1007" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast: vectorized</span></span>
<span id="cb38-1008"><a href="#cb38-1008" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb38-1009"><a href="#cb38-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1010"><a href="#cb38-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># Using apply family</span></span>
<span id="cb38-1011"><a href="#cb38-1011" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>, <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-1012"><a href="#cb38-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1013"><a href="#cb38-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># Even faster: built-in functions</span></span>
<span id="cb38-1014"><a href="#cb38-1014" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb38-1015"><a href="#cb38-1015" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1016"><a href="#cb38-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1017"><a href="#cb38-1017" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parallel Processing</span></span>
<span id="cb38-1018"><a href="#cb38-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1019"><a href="#cb38-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1020"><a href="#cb38-1020" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb38-1021"><a href="#cb38-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1022"><a href="#cb38-1022" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect cores</span></span>
<span id="cb38-1023"><a href="#cb38-1023" aria-hidden="true" tabindex="-1"></a><span class="fu">detectCores</span>()</span>
<span id="cb38-1024"><a href="#cb38-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1025"><a href="#cb38-1025" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel lapply</span></span>
<span id="cb38-1026"><a href="#cb38-1026" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">4</span>)</span>
<span id="cb38-1027"><a href="#cb38-1027" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">parLapply</span>(cl, <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="cf">function</span>(x) x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-1028"><a href="#cb38-1028" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb38-1029"><a href="#cb38-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1030"><a href="#cb38-1030" aria-hidden="true" tabindex="-1"></a><span class="co"># foreach with doParallel</span></span>
<span id="cb38-1031"><a href="#cb38-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb38-1032"><a href="#cb38-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> <span class="dv">4</span>)</span>
<span id="cb38-1033"><a href="#cb38-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1034"><a href="#cb38-1034" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">foreach</span>(<span class="at">i =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="at">.combine =</span> c) <span class="sc">%dopar%</span> {</span>
<span id="cb38-1035"><a href="#cb38-1035" aria-hidden="true" tabindex="-1"></a>  i<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb38-1036"><a href="#cb38-1036" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1037"><a href="#cb38-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1038"><a href="#cb38-1038" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel caret training</span></span>
<span id="cb38-1039"><a href="#cb38-1039" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(<span class="dv">4</span>)</span>
<span id="cb38-1040"><a href="#cb38-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb38-1041"><a href="#cb38-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1042"><a href="#cb38-1042" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb38-1043"><a href="#cb38-1043" aria-hidden="true" tabindex="-1"></a>  Species <span class="sc">~</span> .,</span>
<span id="cb38-1044"><a href="#cb38-1044" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> iris,</span>
<span id="cb38-1045"><a href="#cb38-1045" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb38-1046"><a href="#cb38-1046" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl =</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">allowParallel =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-1047"><a href="#cb38-1047" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-1048"><a href="#cb38-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1049"><a href="#cb38-1049" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb38-1050"><a href="#cb38-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1051"><a href="#cb38-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1052"><a href="#cb38-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">### data.table for Speed</span></span>
<span id="cb38-1053"><a href="#cb38-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1054"><a href="#cb38-1054" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1055"><a href="#cb38-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb38-1056"><a href="#cb38-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1057"><a href="#cb38-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data.table</span></span>
<span id="cb38-1058"><a href="#cb38-1058" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(mtcars)</span>
<span id="cb38-1059"><a href="#cb38-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1060"><a href="#cb38-1060" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast aggregation</span></span>
<span id="cb38-1061"><a href="#cb38-1061" aria-hidden="true" tabindex="-1"></a>dt[, .(<span class="at">avg_mpg =</span> <span class="fu">mean</span>(mpg)), by <span class="ot">=</span> cyl]</span>
<span id="cb38-1062"><a href="#cb38-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1063"><a href="#cb38-1063" aria-hidden="true" tabindex="-1"></a><span class="co"># Fast joins</span></span>
<span id="cb38-1064"><a href="#cb38-1064" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">value =</span> <span class="fu">rnorm</span>(<span class="dv">1000000</span>))</span>
<span id="cb38-1065"><a href="#cb38-1065" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000000</span>, <span class="at">category =</span> <span class="fu">sample</span>(letters, <span class="dv">1000000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb38-1066"><a href="#cb38-1066" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(dt1, id)</span>
<span id="cb38-1067"><a href="#cb38-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">setkey</span>(dt2, id)</span>
<span id="cb38-1068"><a href="#cb38-1068" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> dt1[dt2]  <span class="co"># Fast join</span></span>
<span id="cb38-1069"><a href="#cb38-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1070"><a href="#cb38-1070" aria-hidden="true" tabindex="-1"></a><span class="co"># Update by reference</span></span>
<span id="cb38-1071"><a href="#cb38-1071" aria-hidden="true" tabindex="-1"></a>dt[, new_col <span class="sc">:</span><span class="er">=</span> mpg <span class="sc">*</span> <span class="dv">2</span>]</span>
<span id="cb38-1072"><a href="#cb38-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1073"><a href="#cb38-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1074"><a href="#cb38-1074" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-1075"><a href="#cb38-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1076"><a href="#cb38-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Topics</span></span>
<span id="cb38-1077"><a href="#cb38-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1078"><a href="#cb38-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">### Custom Functions and Debugging</span></span>
<span id="cb38-1079"><a href="#cb38-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1080"><a href="#cb38-1080" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1081"><a href="#cb38-1081" aria-hidden="true" tabindex="-1"></a><span class="co"># Function with error handling</span></span>
<span id="cb38-1082"><a href="#cb38-1082" aria-hidden="true" tabindex="-1"></a>safe_divide <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb38-1083"><a href="#cb38-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tryCatch</span>({</span>
<span id="cb38-1084"><a href="#cb38-1084" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">"Division by zero"</span>)</span>
<span id="cb38-1085"><a href="#cb38-1085" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> x <span class="sc">/</span> y</span>
<span id="cb38-1086"><a href="#cb38-1086" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(result)</span>
<span id="cb38-1087"><a href="#cb38-1087" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb38-1088"><a href="#cb38-1088" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Error: "</span>, e<span class="sc">$</span>message)</span>
<span id="cb38-1089"><a href="#cb38-1089" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb38-1090"><a href="#cb38-1090" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">warning =</span> <span class="cf">function</span>(w) {</span>
<span id="cb38-1091"><a href="#cb38-1091" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Warning: "</span>, w<span class="sc">$</span>message)</span>
<span id="cb38-1092"><a href="#cb38-1092" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb38-1093"><a href="#cb38-1093" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1094"><a href="#cb38-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1095"><a href="#cb38-1095" aria-hidden="true" tabindex="-1"></a><span class="co"># Debugging</span></span>
<span id="cb38-1096"><a href="#cb38-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">debug</span>(my_function)  <span class="co"># Enter debug mode</span></span>
<span id="cb38-1097"><a href="#cb38-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">debugonce</span>(my_function)  <span class="co"># Debug once</span></span>
<span id="cb38-1098"><a href="#cb38-1098" aria-hidden="true" tabindex="-1"></a><span class="fu">undebug</span>(my_function)  <span class="co"># Exit debug mode</span></span>
<span id="cb38-1099"><a href="#cb38-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1100"><a href="#cb38-1100" aria-hidden="true" tabindex="-1"></a><span class="co"># Browser</span></span>
<span id="cb38-1101"><a href="#cb38-1101" aria-hidden="true" tabindex="-1"></a>my_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb38-1102"><a href="#cb38-1102" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb38-1103"><a href="#cb38-1103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">browser</span>()  <span class="co"># Pause execution</span></span>
<span id="cb38-1104"><a href="#cb38-1104" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> y <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb38-1105"><a href="#cb38-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(z)</span>
<span id="cb38-1106"><a href="#cb38-1106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1107"><a href="#cb38-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1108"><a href="#cb38-1108" aria-hidden="true" tabindex="-1"></a><span class="co"># Assertions</span></span>
<span id="cb38-1109"><a href="#cb38-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb38-1110"><a href="#cb38-1110" aria-hidden="true" tabindex="-1"></a>assertthat<span class="sc">::</span><span class="fu">assert_that</span>(<span class="fu">is.numeric</span>(x))</span>
<span id="cb38-1111"><a href="#cb38-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1112"><a href="#cb38-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1113"><a href="#cb38-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">### S3 and S4 Classes</span></span>
<span id="cb38-1114"><a href="#cb38-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1115"><a href="#cb38-1115" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1116"><a href="#cb38-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># S3 class</span></span>
<span id="cb38-1117"><a href="#cb38-1117" aria-hidden="true" tabindex="-1"></a>person <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">name =</span> <span class="st">"Alice"</span>, <span class="at">age =</span> <span class="dv">25</span>)</span>
<span id="cb38-1118"><a href="#cb38-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(person) <span class="ot">&lt;-</span> <span class="st">"Person"</span></span>
<span id="cb38-1119"><a href="#cb38-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1120"><a href="#cb38-1120" aria-hidden="true" tabindex="-1"></a>print.Person <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb38-1121"><a href="#cb38-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Person:"</span>, x<span class="sc">$</span>name, <span class="st">"Age:"</span>, x<span class="sc">$</span>age, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-1122"><a href="#cb38-1122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1123"><a href="#cb38-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1124"><a href="#cb38-1124" aria-hidden="true" tabindex="-1"></a><span class="co"># S4 class</span></span>
<span id="cb38-1125"><a href="#cb38-1125" aria-hidden="true" tabindex="-1"></a><span class="fu">setClass</span>(<span class="st">"Employee"</span>,</span>
<span id="cb38-1126"><a href="#cb38-1126" aria-hidden="true" tabindex="-1"></a>  <span class="at">slots =</span> <span class="fu">list</span>(</span>
<span id="cb38-1127"><a href="#cb38-1127" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"character"</span>,</span>
<span id="cb38-1128"><a href="#cb38-1128" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="st">"numeric"</span>,</span>
<span id="cb38-1129"><a href="#cb38-1129" aria-hidden="true" tabindex="-1"></a>    <span class="at">salary =</span> <span class="st">"numeric"</span></span>
<span id="cb38-1130"><a href="#cb38-1130" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-1131"><a href="#cb38-1131" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-1132"><a href="#cb38-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1133"><a href="#cb38-1133" aria-hidden="true" tabindex="-1"></a>emp <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"Employee"</span>, <span class="at">name =</span> <span class="st">"Bob"</span>, <span class="at">age =</span> <span class="dv">30</span>, <span class="at">salary =</span> <span class="dv">50000</span>)</span>
<span id="cb38-1134"><a href="#cb38-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1135"><a href="#cb38-1135" aria-hidden="true" tabindex="-1"></a><span class="co"># Methods</span></span>
<span id="cb38-1136"><a href="#cb38-1136" aria-hidden="true" tabindex="-1"></a><span class="fu">setGeneric</span>(<span class="st">"getSalary"</span>, <span class="cf">function</span>(obj) <span class="fu">standardGeneric</span>(<span class="st">"getSalary"</span>))</span>
<span id="cb38-1137"><a href="#cb38-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">setMethod</span>(<span class="st">"getSalary"</span>, <span class="st">"Employee"</span>, <span class="cf">function</span>(obj) obj<span class="sc">@</span>salary)</span>
<span id="cb38-1138"><a href="#cb38-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1139"><a href="#cb38-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1140"><a href="#cb38-1140" aria-hidden="true" tabindex="-1"></a><span class="fu">### Writing Packages</span></span>
<span id="cb38-1141"><a href="#cb38-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1142"><a href="#cb38-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1143"><a href="#cb38-1143" aria-hidden="true" tabindex="-1"></a><span class="co"># Create package structure</span></span>
<span id="cb38-1144"><a href="#cb38-1144" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="st">"mypackage"</span>)</span>
<span id="cb38-1145"><a href="#cb38-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1146"><a href="#cb38-1146" aria-hidden="true" tabindex="-1"></a><span class="co"># Add function</span></span>
<span id="cb38-1147"><a href="#cb38-1147" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"my_function"</span>)</span>
<span id="cb38-1148"><a href="#cb38-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1149"><a href="#cb38-1149" aria-hidden="true" tabindex="-1"></a><span class="co"># Add documentation with roxygen2</span></span>
<span id="cb38-1150"><a href="#cb38-1150" aria-hidden="true" tabindex="-1"></a><span class="co">#' Add Two Numbers</span></span>
<span id="cb38-1151"><a href="#cb38-1151" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb38-1152"><a href="#cb38-1152" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x A number</span></span>
<span id="cb38-1153"><a href="#cb38-1153" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param y A number</span></span>
<span id="cb38-1154"><a href="#cb38-1154" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return The sum of x and y</span></span>
<span id="cb38-1155"><a href="#cb38-1155" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb38-1156"><a href="#cb38-1156" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb38-1157"><a href="#cb38-1157" aria-hidden="true" tabindex="-1"></a><span class="co">#' add_numbers(2, 3)</span></span>
<span id="cb38-1158"><a href="#cb38-1158" aria-hidden="true" tabindex="-1"></a>add_numbers <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb38-1159"><a href="#cb38-1159" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb38-1160"><a href="#cb38-1160" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1161"><a href="#cb38-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1162"><a href="#cb38-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate documentation</span></span>
<span id="cb38-1163"><a href="#cb38-1163" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span>
<span id="cb38-1164"><a href="#cb38-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1165"><a href="#cb38-1165" aria-hidden="true" tabindex="-1"></a><span class="co"># Add tests</span></span>
<span id="cb38-1166"><a href="#cb38-1166" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"my_function"</span>)</span>
<span id="cb38-1167"><a href="#cb38-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1168"><a href="#cb38-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># Check package</span></span>
<span id="cb38-1169"><a href="#cb38-1169" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">check</span>()</span>
<span id="cb38-1170"><a href="#cb38-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1171"><a href="#cb38-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># Install</span></span>
<span id="cb38-1172"><a href="#cb38-1172" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install</span>()</span>
<span id="cb38-1173"><a href="#cb38-1173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1174"><a href="#cb38-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1175"><a href="#cb38-1175" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-1176"><a href="#cb38-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1177"><a href="#cb38-1177" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice Projects</span></span>
<span id="cb38-1178"><a href="#cb38-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1179"><a href="#cb38-1179" aria-hidden="true" tabindex="-1"></a><span class="fu">### Project 1: Predictive Modeling Pipeline</span></span>
<span id="cb38-1180"><a href="#cb38-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1181"><a href="#cb38-1181" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1182"><a href="#cb38-1182" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-1183"><a href="#cb38-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb38-1184"><a href="#cb38-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1185"><a href="#cb38-1185" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load and prepare data</span></span>
<span id="cb38-1186"><a href="#cb38-1186" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb38-1187"><a href="#cb38-1187" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb38-1188"><a href="#cb38-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1189"><a href="#cb38-1189" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Split data</span></span>
<span id="cb38-1190"><a href="#cb38-1190" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(iris<span class="sc">$</span>Species, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-1191"><a href="#cb38-1191" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> iris[trainIndex, ]</span>
<span id="cb38-1192"><a href="#cb38-1192" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> iris[<span class="sc">-</span>trainIndex, ]</span>
<span id="cb38-1193"><a href="#cb38-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1194"><a href="#cb38-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Preprocessing</span></span>
<span id="cb38-1195"><a href="#cb38-1195" aria-hidden="true" tabindex="-1"></a>preprocess_params <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(train_data[, <span class="sc">-</span><span class="dv">5</span>], <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb38-1196"><a href="#cb38-1196" aria-hidden="true" tabindex="-1"></a>train_processed <span class="ot">&lt;-</span> <span class="fu">predict</span>(preprocess_params, train_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-1197"><a href="#cb38-1197" aria-hidden="true" tabindex="-1"></a>test_processed <span class="ot">&lt;-</span> <span class="fu">predict</span>(preprocess_params, test_data[, <span class="sc">-</span><span class="dv">5</span>])</span>
<span id="cb38-1198"><a href="#cb38-1198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1199"><a href="#cb38-1199" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Train multiple models</span></span>
<span id="cb38-1200"><a href="#cb38-1200" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-1201"><a href="#cb38-1201" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> <span class="fu">train</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"rf"</span>),</span>
<span id="cb38-1202"><a href="#cb38-1202" aria-hidden="true" tabindex="-1"></a>  <span class="at">svm =</span> <span class="fu">train</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"svmRadial"</span>),</span>
<span id="cb38-1203"><a href="#cb38-1203" aria-hidden="true" tabindex="-1"></a>  <span class="at">gbm =</span> <span class="fu">train</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">method =</span> <span class="st">"gbm"</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-1204"><a href="#cb38-1204" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-1205"><a href="#cb38-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1206"><a href="#cb38-1206" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Evaluate</span></span>
<span id="cb38-1207"><a href="#cb38-1207" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models, <span class="cf">function</span>(m) {</span>
<span id="cb38-1208"><a href="#cb38-1208" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, test_data)</span>
<span id="cb38-1209"><a href="#cb38-1209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">confusionMatrix</span>(pred, test_data<span class="sc">$</span>Species)</span>
<span id="cb38-1210"><a href="#cb38-1210" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-1211"><a href="#cb38-1211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1212"><a href="#cb38-1212" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Select best model</span></span>
<span id="cb38-1213"><a href="#cb38-1213" aria-hidden="true" tabindex="-1"></a>accuracies <span class="ot">&lt;-</span> <span class="fu">sapply</span>(results, <span class="cf">function</span>(r) r<span class="sc">$</span>overall[<span class="st">"Accuracy"</span>])</span>
<span id="cb38-1214"><a href="#cb38-1214" aria-hidden="true" tabindex="-1"></a>best_model <span class="ot">&lt;-</span> models[[<span class="fu">which.max</span>(accuracies)]]</span>
<span id="cb38-1215"><a href="#cb38-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1216"><a href="#cb38-1216" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Save model</span></span>
<span id="cb38-1217"><a href="#cb38-1217" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(best_model, <span class="st">"best_model.rds"</span>)</span>
<span id="cb38-1218"><a href="#cb38-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1219"><a href="#cb38-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1220"><a href="#cb38-1220" aria-hidden="true" tabindex="-1"></a><span class="fu">### Project 2: Time Series Forecasting</span></span>
<span id="cb38-1221"><a href="#cb38-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1222"><a href="#cb38-1222" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb38-1223"><a href="#cb38-1223" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb38-1224"><a href="#cb38-1224" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb38-1225"><a href="#cb38-1225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1226"><a href="#cb38-1226" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load data</span></span>
<span id="cb38-1227"><a href="#cb38-1227" aria-hidden="true" tabindex="-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(AirPassengers, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1949</span>, <span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb38-1228"><a href="#cb38-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1229"><a href="#cb38-1229" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Split train/test</span></span>
<span id="cb38-1230"><a href="#cb38-1230" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_data, <span class="at">end =</span> <span class="fu">c</span>(<span class="dv">1958</span>, <span class="dv">12</span>))</span>
<span id="cb38-1231"><a href="#cb38-1231" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">window</span>(ts_data, <span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1959</span>, <span class="dv">1</span>))</span>
<span id="cb38-1232"><a href="#cb38-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1233"><a href="#cb38-1233" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Fit multiple models</span></span>
<span id="cb38-1234"><a href="#cb38-1234" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb38-1235"><a href="#cb38-1235" aria-hidden="true" tabindex="-1"></a>  <span class="at">arima =</span> <span class="fu">auto.arima</span>(train),</span>
<span id="cb38-1236"><a href="#cb38-1236" aria-hidden="true" tabindex="-1"></a>  <span class="at">ets =</span> <span class="fu">ets</span>(train),</span>
<span id="cb38-1237"><a href="#cb38-1237" aria-hidden="true" tabindex="-1"></a>  <span class="at">tbats =</span> <span class="fu">tbats</span>(train)</span>
<span id="cb38-1238"><a href="#cb38-1238" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-1239"><a href="#cb38-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1240"><a href="#cb38-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Forecast</span></span>
<span id="cb38-1241"><a href="#cb38-1241" aria-hidden="true" tabindex="-1"></a>forecasts <span class="ot">&lt;-</span> <span class="fu">lapply</span>(models, forecast, <span class="at">h =</span> <span class="fu">length</span>(test))</span>
<span id="cb38-1242"><a href="#cb38-1242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1243"><a href="#cb38-1243" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Evaluate</span></span>
<span id="cb38-1244"><a href="#cb38-1244" aria-hidden="true" tabindex="-1"></a>accuracy_results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(forecasts, <span class="cf">function</span>(f) {</span>
<span id="cb38-1245"><a href="#cb38-1245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(f, test)</span>
<span id="cb38-1246"><a href="#cb38-1246" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-1247"><a href="#cb38-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1248"><a href="#cb38-1248" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Visualize</span></span>
<span id="cb38-1249"><a href="#cb38-1249" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb38-1250"><a href="#cb38-1250" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(forecasts)) {</span>
<span id="cb38-1251"><a href="#cb38-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(forecasts[[i]], <span class="at">main =</span> <span class="fu">names</span>(forecasts)[i])</span>
<span id="cb38-1252"><a href="#cb38-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(test, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb38-1253"><a href="#cb38-1253" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-1254"><a href="#cb38-1254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb38-1255"><a href="#cb38-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1256"><a href="#cb38-1256" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb38-1257"><a href="#cb38-1257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1258"><a href="#cb38-1258" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb38-1259"><a href="#cb38-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1260"><a href="#cb38-1260" aria-hidden="true" tabindex="-1"></a><span class="fu">### Skills Mastered</span></span>
<span id="cb38-1261"><a href="#cb38-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1262"><a href="#cb38-1262" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ Statistical modeling (linear, logistic, GLM, mixed models)</span>
<span id="cb38-1263"><a href="#cb38-1263" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ Machine learning with caret and advanced algorithms</span>
<span id="cb38-1264"><a href="#cb38-1264" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ Model evaluation, tuning, and ensemble methods</span>
<span id="cb38-1265"><a href="#cb38-1265" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ Time series analysis and forecasting</span>
<span id="cb38-1266"><a href="#cb38-1266" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ R Markdown for reproducible research</span>
<span id="cb38-1267"><a href="#cb38-1267" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ Performance optimization and parallel processing</span>
<span id="cb38-1268"><a href="#cb38-1268" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>✅ Advanced R programming concepts</span>
<span id="cb38-1269"><a href="#cb38-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1270"><a href="#cb38-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">### Next Steps</span></span>
<span id="cb38-1271"><a href="#cb38-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1272"><a href="#cb38-1272" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Build:** Create end-to-end ML projects</span>
<span id="cb38-1273"><a href="#cb38-1273" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Explore:** Shiny apps (<span class="in">`4_Shiny_Apps_in_R.md`</span>)</span>
<span id="cb38-1274"><a href="#cb38-1274" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Develop:** R packages and developer tools</span>
<span id="cb38-1275"><a href="#cb38-1275" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Publish:** Share analyses on RPubs, GitHub</span>
<span id="cb38-1276"><a href="#cb38-1276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1277"><a href="#cb38-1277" aria-hidden="true" tabindex="-1"></a>**Continue to Shiny Apps! 🚀**</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>